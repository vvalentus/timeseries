
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Ejercicio &#8212; Time Series</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'yahoof';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Series de tiempo" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/image.png" class="logo__image only-light" alt="Time Series - Home"/>
    <script>document.write(`<img src="_static/image.png" class="logo__image only-dark" alt="Time Series - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Series de tiempo
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Ejercicio</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fyahoof.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/yahoof.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Ejercicio</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-sobre-logitech"><span class="math notranslate nohighlight">\(\mathtt{Sobre\;Logitech}\)</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-desarrollo"><span class="math notranslate nohighlight">\(\mathtt{Desarrollo}\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-librerias"><span class="math notranslate nohighlight">\(\mathtt{Librerías}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-importar-datos"><span class="math notranslate nohighlight">\(\mathtt{Importar\;datos}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-analisis-exploratorio"><span class="math notranslate nohighlight">\(\mathtt{Análisis\;exploratorio}\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-serie-original"><span class="math notranslate nohighlight">\(\mathtt{Serie\;original}\)</span></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-autocorrelacion"><span class="math notranslate nohighlight">\(\mathtt{Autocorrelación}\)</span></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-autocorrelacion-parcial"><span class="math notranslate nohighlight">\(\mathtt{Autocorrelación\;parcial}\)</span></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-estacionariedad-por-metodo-analitico-dickey-fuller"><span class="math notranslate nohighlight">\(\mathtt{Estacionariedad\;por\;método\;analítico\;(Dickey\;Fuller)}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-descomposicion-de-la-serie"><span class="math notranslate nohighlight">\(\mathtt{Descomposición\;de\;la\;serie}\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-modelo-arima"><span class="math notranslate nohighlight">\(\mathtt{Modelo:\;ARIMA}\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-diferenciacion"><span class="math notranslate nohighlight">\(\mathtt{Diferenciación}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-criterios-aic-bic-hqic"><span class="math notranslate nohighlight">\(\mathtt{Criterios\;AIC,\;BIC,\;HQIC}\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-funciones-auxiliares"><span class="math notranslate nohighlight">\(\mathtt{Funciones\;auxiliares}\)</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-arima-aic"><span class="math notranslate nohighlight">\(\mathtt{ARIMA:\;AIC}\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-arima-con-rolling"><span class="math notranslate nohighlight">\(\mathtt{ARIMA \; con\;rolling}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-arima-sin-rolling"><span class="math notranslate nohighlight">\(\mathtt{ARIMA\;sin\;rolling}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-normalidad-e-independencia-de-los-residuos"><span class="math notranslate nohighlight">\(\mathtt{Normalidad\;e\;independencia\;de\;los\;residuos}\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-arima-bic"><span class="math notranslate nohighlight">\(\mathtt{ARIMA:\;BIC}\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"><span class="math notranslate nohighlight">\(\mathtt{ARIMA \; con\;rolling}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2"><span class="math notranslate nohighlight">\(\mathtt{ARIMA \; sin\;rolling}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3"><span class="math notranslate nohighlight">\(\mathtt{Normalidad\;e\;independencia\;de\;los\;residuos}\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-arima-hqic"><span class="math notranslate nohighlight">\(\mathtt{ARIMA:\;HQIC}\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4"><span class="math notranslate nohighlight">\(\mathtt{ARIMA \; con\;rolling}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5"><span class="math notranslate nohighlight">\(\mathtt{ARIMA \; sin\;rolling}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6"><span class="math notranslate nohighlight">\(\mathtt{Normalidad\;e\;independencia\;de\;los\;residuos}\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-analisis-de-metricas-por-criterio"><span class="math notranslate nohighlight">\(\mathtt{Análisis\;de\;métricas\;por\;criterio}\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-conclusiones"><span class="math notranslate nohighlight">\(\mathtt{Conclusiones}\)</span></a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="ejercicio">
<h1>Ejercicio<a class="headerlink" href="#ejercicio" title="Link to this heading">#</a></h1>
<section id="mathtt-sobre-logitech">
<h2><span class="math notranslate nohighlight">\(\mathtt{Sobre\;Logitech}\)</span><a class="headerlink" href="#mathtt-sobre-logitech" title="Link to this heading">#</a></h2>
<p><em><strong>Logitech International S.A</strong></em>. es una empresa suiza-estadounidense que se especializa en la fabricación de productos periféricos para computadoras y tecnología. Fundada en 1981, es conocida por desarrollar ratones, teclados, cámaras web, auriculares y dispositivos de juego. Logitech ha sido pionera en el diseño innovador de hardware, enfocándose en la calidad y funcionalidad de sus productos, y ha expandido su gama de productos a soluciones de videoconferencia, accesorios para consolas de videojuegos y dispositivos para el hogar inteligente. <em>Su presencia global la posiciona como una marca reconocida en el sector tecnológico</em>.</p>
</section>
<section id="mathtt-desarrollo">
<h2><span class="math notranslate nohighlight">\(\mathtt{Desarrollo}\)</span><a class="headerlink" href="#mathtt-desarrollo" title="Link to this heading">#</a></h2>
<section id="mathtt-librerias">
<h3><span class="math notranslate nohighlight">\(\mathtt{Librerías}\)</span><a class="headerlink" href="#mathtt-librerias" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">yfinance</span> <span class="k">as</span> <span class="nn">yf</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">figure</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">legend</span><span class="p">,</span> <span class="n">close</span><span class="p">,</span> <span class="n">subplots</span><span class="p">,</span> <span class="n">title</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>

<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa</span> <span class="kn">import</span> <span class="n">seasonal</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_percentage_error</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">shapiro</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s2">&quot;paper&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="mathtt-importar-datos">
<h3><span class="math notranslate nohighlight">\(\mathtt{Importar\;datos}\)</span><a class="headerlink" href="#mathtt-importar-datos" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ticker</span> <span class="o">=</span> <span class="s1">&#39;LOGI&#39;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">&quot;2014-01-01&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;2024-09-14&quot;</span><span class="p">)</span> 
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[*********************100%***********************]  1 of 1 completed
</pre></div>
</div>
</div>
</div>
<p>Aquí se encuentra información histórica sobre el precio de la acción de <strong>Logitech International S.A.</strong> de 2693 días desde el primero de enero del 2014 hasta el 13 de septiembre del 2024. Los datos incluyen el precio de apertura, precio más alto y más bajo del día, precio de cierre y volumen de operaciones.</p>
</section>
<section id="mathtt-analisis-exploratorio">
<h3><span class="math notranslate nohighlight">\(\mathtt{Análisis\;exploratorio}\)</span><a class="headerlink" href="#mathtt-analisis-exploratorio" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 2693 entries, 2014-01-02 to 2024-09-13
Data columns (total 6 columns):
 #   Column     Non-Null Count  Dtype  
---  ------     --------------  -----  
 0   Open       2693 non-null   float64
 1   High       2693 non-null   float64
 2   Low        2693 non-null   float64
 3   Close      2693 non-null   float64
 4   Adj Close  2693 non-null   float64
 5   Volume     2693 non-null   int64  
dtypes: float64(5), int64(1)
memory usage: 147.3 KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2693, 6)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Adj Close</th>
      <th>Volume</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2014-01-02</th>
      <td>13.51</td>
      <td>13.54</td>
      <td>13.12</td>
      <td>13.35</td>
      <td>10.990413</td>
      <td>431500</td>
    </tr>
    <tr>
      <th>2014-01-03</th>
      <td>13.45</td>
      <td>13.48</td>
      <td>13.32</td>
      <td>13.40</td>
      <td>11.031575</td>
      <td>289200</td>
    </tr>
    <tr>
      <th>2014-01-06</th>
      <td>13.74</td>
      <td>13.80</td>
      <td>13.58</td>
      <td>13.59</td>
      <td>11.187994</td>
      <td>460600</td>
    </tr>
    <tr>
      <th>2014-01-07</th>
      <td>14.04</td>
      <td>14.22</td>
      <td>13.96</td>
      <td>14.05</td>
      <td>11.566690</td>
      <td>760900</td>
    </tr>
    <tr>
      <th>2014-01-08</th>
      <td>14.19</td>
      <td>14.29</td>
      <td>13.94</td>
      <td>14.01</td>
      <td>11.533759</td>
      <td>983700</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Adj Close</th>
      <th>Volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>2693.000000</td>
      <td>2693.000000</td>
      <td>2693.000000</td>
      <td>2693.000000</td>
      <td>2693.000000</td>
      <td>2.693000e+03</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>48.469896</td>
      <td>48.937308</td>
      <td>48.011170</td>
      <td>48.492551</td>
      <td>46.149355</td>
      <td>5.284367e+05</td>
    </tr>
    <tr>
      <th>std</th>
      <td>29.614433</td>
      <td>29.926410</td>
      <td>29.285854</td>
      <td>29.624649</td>
      <td>29.380180</td>
      <td>4.917642e+05</td>
    </tr>
    <tr>
      <th>min</th>
      <td>11.210000</td>
      <td>11.530000</td>
      <td>11.200000</td>
      <td>11.510000</td>
      <td>9.636723</td>
      <td>4.650000e+04</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>21.559999</td>
      <td>21.740000</td>
      <td>21.480000</td>
      <td>21.639999</td>
      <td>19.302317</td>
      <td>2.605000e+05</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>40.889999</td>
      <td>41.139999</td>
      <td>40.619999</td>
      <td>40.900002</td>
      <td>38.433517</td>
      <td>4.053000e+05</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>70.500000</td>
      <td>71.309998</td>
      <td>69.830002</td>
      <td>70.470001</td>
      <td>68.260002</td>
      <td>6.299000e+05</td>
    </tr>
    <tr>
      <th>max</th>
      <td>137.990005</td>
      <td>140.169998</td>
      <td>137.649994</td>
      <td>138.699997</td>
      <td>132.198685</td>
      <td>7.572900e+06</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="mf">7.5729</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7572900.0
</pre></div>
</div>
</div>
</div>
<p>En promedio, durante los 10 años analizados, la acción abrió la jornada en <span class="math notranslate nohighlight">\(48.46 y cerró en \)</span>48.49, fluctuando entre un mínimo de <span class="math notranslate nohighlight">\(48.01 y un máximo de \)</span>48.93 a lo largo del día, lo que refleja una estabilidad moderada con baja volatilidad diaria. Además, se negociaron en promedio 528,000 acciones por día, con un mínimo de 46,500 acciones y un máximo 7’572,900, mostrando una considerable variabilidad en el volumen de transacciones, lo que sugiere fluctuaciones en el interés del mercado.</p>
<section id="mathtt-serie-original">
<h4><span class="math notranslate nohighlight">\(\mathtt{Serie\;original}\)</span><a class="headerlink" href="#mathtt-serie-original" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nlag</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn-v0_8-notebook&#39;</span><span class="p">)</span>

<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Serie Original&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Close&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7f4d8e864ba8d4ea883d63e2bcdf84267d7d803d08c918657bfa611dd22ecf3f.png" src="_images/7f4d8e864ba8d4ea883d63e2bcdf84267d7d803d08c918657bfa611dd22ecf3f.png" />
</div>
</div>
<p>Se puede notar un aumento en el precio de cierre a lo largo de los años, entre 2020 y finales del 2021 este crecimiento fue más notorio. Hubo una gran disminución en el precio de ajustado de cierre desde finales del 2021 hasta mediados del 2022. No parece ser estacionaria.</p>
</section>
<section id="mathtt-autocorrelacion">
<h4><span class="math notranslate nohighlight">\(\mathtt{Autocorrelación}\)</span><a class="headerlink" href="#mathtt-autocorrelacion" title="Link to this heading">#</a></h4>
<p>Acá, usamos los lags para medir la autocorrelación, que es la correlación de la serie de tiempo con una versión retrasada de sí misma, para identificar patrones y posibles dependencias temporales en los datos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_acf</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="n">nlag</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># Autocorrelación</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Autocorrelación&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a437673c564e7ae55cee20383c1dd2169057b60bfa8eedb65efc85b1096f4e06.png" src="_images/a437673c564e7ae55cee20383c1dd2169057b60bfa8eedb65efc85b1096f4e06.png" />
</div>
</div>
<p>Al revisar la autocorrelación se nota una fuerte correlación temporal entre los valores del precio de cierre en diferentes momentos, lo que sugiere un patrón de dependencia a largo plazo o incluso la presencia de una tendencia en los datos. Además, dado que todos estos valores recaen bajo la zona sombreada, los valores de la serie están correlacionados con los valores de esos periodos anteriores de manera significativa.</p>
</section>
<section id="mathtt-autocorrelacion-parcial">
<h4><span class="math notranslate nohighlight">\(\mathtt{Autocorrelación\;parcial}\)</span><a class="headerlink" href="#mathtt-autocorrelacion-parcial" title="Link to this heading">#</a></h4>
<p>La gráfica de autocorrelación parcial, a diferencia de la grafica de autocorrelación, mide la correlación entre una observación y su lag específico, eliminando el efecto de los lags intermedios.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_pacf</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">],</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Autocorrelación parcial&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6ae17a0f1d1c1f890d97a9b31dc63ecefd83c6d696b5b8c9946813e9f2732dab.png" src="_images/6ae17a0f1d1c1f890d97a9b31dc63ecefd83c6d696b5b8c9946813e9f2732dab.png" />
</div>
</div>
<p>Los coeficientes PACF bajan rápidamente hacia 0, indicando que solo los primeros lags tienen una influencia significativa directa sobre los valores actuales. La gran mayoría de las observaciones de los lags no son significativas.</p>
</section>
</section>
<section id="mathtt-estacionariedad-por-metodo-analitico-dickey-fuller">
<h3><span class="math notranslate nohighlight">\(\mathtt{Estacionariedad\;por\;método\;analítico\;(Dickey\;Fuller)}\)</span><a class="headerlink" href="#mathtt-estacionariedad-por-metodo-analitico-dickey-fuller" title="Link to this heading">#</a></h3>
<p><strong><span class="math notranslate nohighlight">\(H_{\theta} : ρ \geq \alpha\)</span></strong> La serie tiene una raíz unitaria y no es estacionaria.</p>
<p><strong><span class="math notranslate nohighlight">\(H_{1} : ρ &lt; \alpha\)</span></strong> La serie no tiene una raíz unitaria y es estacionaria.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Close&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ADF Statistic: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">adf_result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-value: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ADF Statistic: -0.962046
p-value: 0.766854
</pre></div>
</div>
</div>
</div>
<p>Teniendo en cuenta el valor de ADF, el cual no es un valor tan negativo, sugiere que no es estacionaria. Además, dado que el <span class="math notranslate nohighlight">\(𝑝-valor\)</span> de la prueba de Dickey Fuller es <span class="math notranslate nohighlight">\(0.766854 &gt; 0.05 = \alpha\)</span>, no se rechaza la hipótesis nula, es decir, la serie temporal <strong>no es estacionaria.</strong></p>
</section>
<section id="mathtt-descomposicion-de-la-serie">
<h3><span class="math notranslate nohighlight">\(\mathtt{Descomposición\;de\;la\;serie}\)</span><a class="headerlink" href="#mathtt-descomposicion-de-la-serie" title="Link to this heading">#</a></h3>
<p>La descomposición de series temporales es una técnica que permite comprender los componentes de una serie temporal desglosando los datos en sus partes constituyentes, como la tendencia, la estacionalidad y los residuos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">decompose_model</span> <span class="o">=</span> <span class="n">seasonal</span><span class="o">.</span><span class="n">seasonal_decompose</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Close&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
<span class="n">period</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;additive&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>

<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;LOGITECH&#39;</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">decompose_model</span><span class="o">.</span><span class="n">trend</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
<span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Componente tendencial del precio de cierre de Logitech&#39;</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">decompose_model</span><span class="o">.</span><span class="n">seasonal</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span>
<span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Componente estacional del precio de cierre de Logitech&#39;</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">decompose_model</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
<span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">axarr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Componente residual del precio de cierre de Logitech&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Componente residual del precio de cierre de Logitech&#39;)
</pre></div>
</div>
<img alt="_images/38b27e3f70231d8917150653a45d26f7acf3600453d5d4dff1ec972353b310f6.png" src="_images/38b27e3f70231d8917150653a45d26f7acf3600453d5d4dff1ec972353b310f6.png" />
</div>
</div>
<p><span class="math notranslate nohighlight">\(1.\;\mathtt{Componente\;tendencial: }\)</span> este representa el movimiento o la dirección de los datos a largo plazo que puede caracterizarse por un aumento o una disminución gradual o por una estabilidad a lo largo de un período prolongado. Para Logitech, en los últimos 10 años parece haber un tendencia hacia el aumento del precio de cierre a lo largo de los años de manera gradual.</p>
<p><span class="math notranslate nohighlight">\(2.\;\mathtt{Componente\;estacional: }\)</span> este da cuenta de patrones regulares y recurrentes que se manifiestan en intervalos de tiempo fijos. En la gráfica se observa un patrón y amplitud constante en los años.</p>
<p><span class="math notranslate nohighlight">\(3.\;\mathtt{Componente\;residual: }\)</span> por último, el componente residual o error captura las fluctuaciones aleatorias o <em>ruido</em> que no pueden ser explicadas por la tendencia o el componente estacional. Esta no parece tener un patrón según la gráfica.</p>
<p>Verifiquemos ahora la no estacionalidad y normalidad de los residuos de la descomposición.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">decompose_model</span><span class="o">.</span><span class="n">resid</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">decompose_model</span><span class="o">.</span><span class="n">resid</span><span class="p">))[</span><span class="mi">0</span><span class="p">]],</span><span class="n">autolag</span><span class="o">=</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.09958429416318e-26
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">decompose_model</span> <span class="o">=</span> <span class="n">seasonal</span><span class="o">.</span><span class="n">seasonal_decompose</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">],</span> <span class="n">period</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;additive&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">)})</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">qqplot</span><span class="p">(</span><span class="n">decompose_model</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">line</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Q-Q Plot of Residuals&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Theoretical Quantiles&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sample Quantiles&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2755dfe5bf808ebc53217ca80abed9f05a8147c08c129f02f99d154180ec307a.png" src="_images/2755dfe5bf808ebc53217ca80abed9f05a8147c08c129f02f99d154180ec307a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resid_clean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">decompose_model</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">stat</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">shapiro</span><span class="p">(</span><span class="n">resid_clean</span><span class="p">)</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Normal&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No normal&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Statistics=</span><span class="si">%.3f</span><span class="s1">, p=</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No normal
Statistics=0.874, p=0.000
</pre></div>
</div>
</div>
</div>
<p>Donde se encuentra que los residuos no siguen una distribución normal, algo bastante notable en la gráfica QQ de los residuos. Además, aparentemente son estacionarios debido al <span class="math notranslate nohighlight">\(p-valor\)</span> tan pequeño obtenido del test de Dickey Fuller para los residuos.</p>
</section>
</section>
<section id="mathtt-modelo-arima">
<h2><span class="math notranslate nohighlight">\(\mathtt{Modelo:\;ARIMA}\)</span><a class="headerlink" href="#mathtt-modelo-arima" title="Link to this heading">#</a></h2>
<p>El modelo ARIMA (<em>AutoRegressive Integrated Moving Average</em>) es una herramienta estadística de gran utilidad para analizar y pronosticar datos de series temporales. Se adapta explícitamente a un conjunto de estructuras estándar en datos de series temporales y, como tal, proporciona un método simple pero potente para realizar pronósticos hábiles de series temporales.</p>
<p>Los parámetros del modelo ARIMA se definen de la siguiente manera:</p>
<p><span class="math notranslate nohighlight">\(-\;p:\)</span> orden de retardo, que representa la cantidad de observaciones de retardo incorporadas en el modelo.<span class="math notranslate nohighlight">\(\newline\)</span>
<span class="math notranslate nohighlight">\(-\;d:\)</span> grado de diferenciación, que indica la cantidad de veces que las observaciones brutas se someten a diferenciación.<span class="math notranslate nohighlight">\(\newline\)</span>
<span class="math notranslate nohighlight">\(-\;q:\)</span> orden de promedio móvil, que indica el tamaño de la ventana de promedio móvil.<span class="math notranslate nohighlight">\(\newline\)</span></p>
<p><a class="reference external" href="https://machinelearningmastery.com/arima-for-time-series-forecasting-with-python/">https://machinelearningmastery.com/arima-for-time-series-forecasting-with-python/</a></p>
<section id="mathtt-diferenciacion">
<h3><span class="math notranslate nohighlight">\(\mathtt{Diferenciación}\)</span><a class="headerlink" href="#mathtt-diferenciacion" title="Link to this heading">#</a></h3>
<p>La diferenciación puede ayudar a estabilizar la media de una serie temporal eliminando cambios en el nivel de una serie temporal y, por tanto, eliminando (o reduciendo) la tendencia y la estacionalidad.</p>
<p><a class="reference external" href="https://otexts.com/fpp2/stationarity.html">https://otexts.com/fpp2/stationarity.html</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_reset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn-v0_8-notebook&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">)})</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_reset</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span> <span class="n">data_reset</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Serie Original&#39;</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_reset</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span> <span class="n">data_reset</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">())</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Diferenciación de Primer Orden&#39;</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_reset</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span> <span class="n">data_reset</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">())</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Diferenciación de Segundo Orden&#39;</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/695c0ca1276b3b97e8d8bdeb33a2670f5d4231f11c940c0e73e0449173843b1e.png" src="_images/695c0ca1276b3b97e8d8bdeb33a2670f5d4231f11c940c0e73e0449173843b1e.png" />
</div>
</div>
<p>El cambio brusco en la autocorrelación de la diferenciación de segundo orden hay un cambio brusco en el lag 1 de positivo a negativo sugiere que la serie ha sido sobrediferenciada, además de más valores fuera del 95%. Se puede observar también la mejora en la estacionaridad, pasando de una serie no estacionaria a una estacionaria. Para confirmar esto, dado que la de segundo orden parece sobrediferenciada, se realizará la prueba de Dickey Fuller para la diferenciación de primer orden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Primer orden&#39;</span><span class="p">)</span>
<span class="n">adf_result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Close&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ADF Statistic: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">adf_result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-value: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Segundo orden&#39;</span><span class="p">)</span>
<span class="n">adf_result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Close&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ADF Statistic: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">adf_result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-value: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Primer orden
ADF Statistic: -11.631321
p-value: 0.000000
Segundo orden
ADF Statistic: -18.357593
p-value: 0.000000
</pre></div>
</div>
</div>
</div>
<p>Acá se compureba que ambas diferenciaciones, tanto la de primer como segundo orden <strong>son estacionarias</strong>.</p>
</section>
<section id="mathtt-criterios-aic-bic-hqic">
<h3><span class="math notranslate nohighlight">\(\mathtt{Criterios\;AIC,\;BIC,\;HQIC}\)</span><a class="headerlink" href="#mathtt-criterios-aic-bic-hqic" title="Link to this heading">#</a></h3>
<p>Los criterios <em>AIC</em> (Akaike Information Criterion), <em>BIC</em> (Bayesian Information Criterion) y <em>HQIC</em> (Hannan-Quinn Information Criterion) son herramientas utilizadas en la selección de modelos estadísticos para determinar cuál es el modelo más adecuado entre varios candidatos. Cada uno de estos criterios tiene un enfoque ligeramente diferente en la penalización por la complejidad del modelo</p>
<ul class="simple">
<li><p>AIC se utiliza cuando se busca un equilibrio entre ajuste y complejidad.</p></li>
<li><p>BIC es preferido si se desea evitar sobreajuste, especialmente con muestras grandes.</p></li>
<li><p>HQIC es una opción intermedia que puede ser útil si ninguno de los extremos de AIC o BIC se ajusta bien a las necesidades.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]);</span> <span class="n">n_test</span> <span class="o">=</span> <span class="mi">29</span><span class="p">;</span> <span class="n">train_size</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">n_test</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">][:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">dates_train</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>

<span class="n">test</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">][</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
<span class="n">dates</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;train:&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;test:&quot;</span><span class="p">,</span> <span class="n">test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>train: (2664,)
test: (29,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">evaluate_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">aic</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">hqic</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al ajustar el modelo con orden </span><span class="si">{</span><span class="n">order</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

<span class="k">def</span> <span class="nf">find_best_arima_order</span><span class="p">(</span><span class="n">train</span><span class="p">):</span>
    <span class="n">best_criteria</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;aic&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="s1">&#39;bic&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="s1">&#39;hqic&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">}</span>
    <span class="n">best_orders</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;aic&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;bic&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;hqic&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
    <span class="n">best_models</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;aic&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;bic&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;hqic&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

    <span class="n">pq_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">d_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pq_rng</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">d_rng</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">pq_rng</span><span class="p">:</span>
                <span class="n">order</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
                <span class="n">aic</span><span class="p">,</span> <span class="n">bic</span><span class="p">,</span> <span class="n">hqic</span> <span class="o">=</span> <span class="n">evaluate_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">aic</span> <span class="o">&lt;</span> <span class="n">best_criteria</span><span class="p">[</span><span class="s1">&#39;aic&#39;</span><span class="p">]:</span>
                    <span class="n">best_criteria</span><span class="p">[</span><span class="s1">&#39;aic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aic</span>
                    <span class="n">best_orders</span><span class="p">[</span><span class="s1">&#39;aic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">order</span>
                    <span class="n">best_models</span><span class="p">[</span><span class="s1">&#39;aic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">aic</span><span class="p">,</span> <span class="n">bic</span><span class="p">,</span> <span class="n">hqic</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">bic</span> <span class="o">&lt;</span> <span class="n">best_criteria</span><span class="p">[</span><span class="s1">&#39;bic&#39;</span><span class="p">]:</span>
                    <span class="n">best_criteria</span><span class="p">[</span><span class="s1">&#39;bic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bic</span>
                    <span class="n">best_orders</span><span class="p">[</span><span class="s1">&#39;bic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">order</span>
                    <span class="n">best_models</span><span class="p">[</span><span class="s1">&#39;bic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">aic</span><span class="p">,</span> <span class="n">bic</span><span class="p">,</span> <span class="n">hqic</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">hqic</span> <span class="o">&lt;</span> <span class="n">best_criteria</span><span class="p">[</span><span class="s1">&#39;hqic&#39;</span><span class="p">]:</span>
                    <span class="n">best_criteria</span><span class="p">[</span><span class="s1">&#39;hqic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hqic</span>
                    <span class="n">best_orders</span><span class="p">[</span><span class="s1">&#39;hqic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">order</span>
                    <span class="n">best_models</span><span class="p">[</span><span class="s1">&#39;hqic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">aic</span><span class="p">,</span> <span class="n">bic</span><span class="p">,</span> <span class="n">hqic</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;best_order_aic&#39;</span><span class="p">:</span> <span class="n">best_orders</span><span class="p">[</span><span class="s1">&#39;aic&#39;</span><span class="p">],</span>
        <span class="s1">&#39;best_aic&#39;</span><span class="p">:</span> <span class="n">best_criteria</span><span class="p">[</span><span class="s1">&#39;aic&#39;</span><span class="p">],</span>
        <span class="s1">&#39;best_order_bic&#39;</span><span class="p">:</span> <span class="n">best_orders</span><span class="p">[</span><span class="s1">&#39;bic&#39;</span><span class="p">],</span>
        <span class="s1">&#39;best_bic&#39;</span><span class="p">:</span> <span class="n">best_criteria</span><span class="p">[</span><span class="s1">&#39;bic&#39;</span><span class="p">],</span>
        <span class="s1">&#39;best_order_hqic&#39;</span><span class="p">:</span> <span class="n">best_orders</span><span class="p">[</span><span class="s1">&#39;hqic&#39;</span><span class="p">],</span>
        <span class="s1">&#39;best_hqic&#39;</span><span class="p">:</span> <span class="n">best_criteria</span><span class="p">[</span><span class="s1">&#39;hqic&#39;</span><span class="p">]</span>
    <span class="p">}</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">find_best_arima_order</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor orden AIC: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;best_order_aic&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, AIC: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;best_aic&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor orden BIC: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;best_order_bic&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, BIC: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;best_bic&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor orden HQIC: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;best_order_hqic&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, HQIC: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;best_hqic&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mejor orden AIC: (4, 1, 4), AIC: 8938.104514795763
Mejor orden BIC: (0, 1, 0), BIC: 8960.912039509234
Mejor orden HQIC: (3, 1, 2), HQIC: 8951.554096999918
</pre></div>
</div>
</div>
</div>
<p>El modelo ARIMA se define por tres parámetros: el primero corresponde al orden autoregresivo (<span class="math notranslate nohighlight">\(p\)</span>), el segundo a la diferenciación (<span class="math notranslate nohighlight">\(d\)</span>) y el tercero al número de términos de media móvil (<span class="math notranslate nohighlight">\(q\)</span>). En el caso del mejor modelo según el criterio AIC, el orden (4, 1, 4) significa que se están utilizando 4 términos autoregresivos (<span class="math notranslate nohighlight">\(p=4\)</span>), una diferenciación para hacer la serie estacionaria (<span class="math notranslate nohighlight">\(d=1\)</span>), y 4 términos de media móvil (<span class="math notranslate nohighlight">\(q=4\)</span>), lo que resulta en un ajuste más preciso a los datos. Según el criterio BIC, el modelo más simple tiene un orden (0, 1, 0), es decir, no incluye términos autoregresivos ni de media móvil, solo una diferenciación (<span class="math notranslate nohighlight">\(d=1\)</span>). Por último, el modelo seleccionado por el HQIC tiene un orden (3, 1, 2), lo que significa que emplea 3 términos autoregresivos (<span class="math notranslate nohighlight">\(p=3\)</span>), una diferenciación (<span class="math notranslate nohighlight">\(d=1\)</span>) y 2 términos de media móvil (<span class="math notranslate nohighlight">\(q=2\)</span>), encontrando un equilibrio entre ajuste y simplicidad</p>
<section id="mathtt-funciones-auxiliares">
<h4><span class="math notranslate nohighlight">\(\mathtt{Funciones\;auxiliares}\)</span><a class="headerlink" href="#mathtt-funciones-auxiliares" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fit_arima_model</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
        <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">model_fit</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al ajustar el modelo ARIMA con el orden </span><span class="si">{</span><span class="n">order</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_error_table</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>

    <span class="n">errors</span> <span class="o">=</span> <span class="n">calculate_errors</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">df_errors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Métrica&#39;</span><span class="p">,</span> <span class="s1">&#39;Valor&#39;</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">df_errors</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_errors</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="c1"># Calcular MAPE</span>
    <span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_true</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="c1"># Calcular MAE</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="c1"># Calcular MSE</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="c1"># Calcular RMSE</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>

    <span class="c1"># Calcular R2</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">mape</span><span class="p">,</span>
        <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="n">mae</span><span class="p">,</span>
        <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="n">mse</span><span class="p">,</span>
        <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">,</span>
        <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">r2</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="mathtt-arima-aic">
<h2><span class="math notranslate nohighlight">\(\mathtt{ARIMA:\;AIC}\)</span><a class="headerlink" href="#mathtt-arima-aic" title="Link to this heading">#</a></h2>
<section id="mathtt-arima-con-rolling">
<h3><span class="math notranslate nohighlight">\(\mathtt{ARIMA \; con\;rolling}\)</span><a class="headerlink" href="#mathtt-arima-con-rolling" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">arima_rolling</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">best_order</span><span class="p">):</span>
    
    <span class="n">predictions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
        <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
        <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>

        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;predicted=</span><span class="si">%f</span><span class="s1">, expected=</span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yhat</span><span class="p">,</span> <span class="n">obs</span><span class="p">))</span>
        
    <span class="k">return</span> <span class="n">predictions</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">horizons</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">28</span><span class="p">]</span>
<span class="n">results_rolling</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">horizons</span><span class="p">:</span>
    <span class="n">results_rolling</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">arima_rolling</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="n">test</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;best_order_aic&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>predicted=87.454185, expected=84.849998
predicted=85.156928, expected=84.599998
predicted=84.642357, expected=83.699997
predicted=83.831259, expected=85.480003
predicted=85.622751, expected=86.120003
predicted=86.184269, expected=86.650002
predicted=86.627259, expected=87.760002
predicted=87.454185, expected=84.849998
predicted=85.156928, expected=84.599998
predicted=84.642357, expected=83.699997
predicted=83.831259, expected=85.480003
predicted=85.622751, expected=86.120003
predicted=86.184269, expected=86.650002
predicted=86.627259, expected=87.760002
predicted=87.485034, expected=88.260002
predicted=88.132949, expected=89.160004
predicted=88.960864, expected=90.230003
predicted=90.239447, expected=91.260002
predicted=91.072289, expected=91.620003
predicted=91.598002, expected=92.639999
predicted=92.507822, expected=91.129997
predicted=87.454185, expected=84.849998
predicted=85.156928, expected=84.599998
predicted=84.642357, expected=83.699997
predicted=83.831259, expected=85.480003
predicted=85.622751, expected=86.120003
predicted=86.184269, expected=86.650002
predicted=86.627259, expected=87.760002
predicted=87.485034, expected=88.260002
predicted=88.132949, expected=89.160004
predicted=88.960864, expected=90.230003
predicted=90.239447, expected=91.260002
predicted=91.072289, expected=91.620003
predicted=91.598002, expected=92.639999
predicted=92.507822, expected=91.129997
predicted=91.155756, expected=92.260002
predicted=92.207173, expected=90.860001
predicted=91.109138, expected=90.879997
predicted=91.088994, expected=90.209999
predicted=90.356049, expected=90.379997
predicted=90.492493, expected=91.010002
predicted=90.958744, expected=88.660004
predicted=87.454185, expected=84.849998
predicted=85.156928, expected=84.599998
predicted=84.642357, expected=83.699997
predicted=83.831259, expected=85.480003
predicted=85.622751, expected=86.120003
predicted=86.184269, expected=86.650002
predicted=86.627259, expected=87.760002
predicted=87.485034, expected=88.260002
predicted=88.132949, expected=89.160004
predicted=88.960864, expected=90.230003
predicted=90.239447, expected=91.260002
predicted=91.072289, expected=91.620003
predicted=91.598002, expected=92.639999
predicted=92.507822, expected=91.129997
predicted=91.155756, expected=92.260002
predicted=92.207173, expected=90.860001
predicted=91.109138, expected=90.879997
predicted=91.088994, expected=90.209999
predicted=90.356049, expected=90.379997
predicted=90.492493, expected=91.010002
predicted=90.958744, expected=88.660004
predicted=88.617827, expected=86.290001
predicted=86.239101, expected=85.830002
predicted=86.056567, expected=84.900002
predicted=84.980774, expected=84.709999
predicted=84.862228, expected=85.190002
predicted=85.241381, expected=84.559998
predicted=84.658086, expected=84.930000
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">horizons</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">28</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">horizon</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">horizons</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">]</span>

    <span class="n">dates_test</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[:</span><span class="n">horizon</span><span class="p">]</span>
    <span class="n">predicted_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">results_rolling</span><span class="p">[</span><span class="n">horizon</span><span class="p">]]</span>
    
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Test&#39;</span><span class="p">:</span> <span class="n">test</span><span class="p">[:</span><span class="n">horizon</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">test</span><span class="p">[:</span><span class="n">horizon</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="n">pred_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Date&#39;</span><span class="p">:</span> <span class="n">dates_test</span><span class="p">,</span>
        <span class="s1">&#39;Forecast&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">predicted_values</span><span class="p">)</span>
    <span class="p">})</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>

    
    <span class="n">train_dates</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">index</span>
    <span class="n">train_values</span> <span class="o">=</span> <span class="n">train</span>
    
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">train_dates</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:],</span> <span class="n">y</span><span class="o">=</span><span class="n">train_values</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#00008B&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">pred_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#32a850&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">pred_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">]],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Forecast&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#a83264&#39;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Horizonte de </span><span class="si">{</span><span class="n">horizon</span><span class="si">}</span><span class="s1"> días&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/197e65c968b4e11110009fd3cc28f5771fc31e5227bbace2f50163358bb04161.png" src="_images/197e65c968b4e11110009fd3cc28f5771fc31e5227bbace2f50163358bb04161.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">comparison_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Real&#39;</span><span class="p">:</span> <span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Predicted&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">]]</span>
<span class="p">})</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">comparison_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Predicted&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="n">min_val</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Real&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Predicted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">max_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Real&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Predicted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span> <span class="p">[</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Comparación entre Valores Reales y Predicciones&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Valor Real&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Valor Predicho&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2431728c621976f52ca15b45c321e0f5ac14e948774e7245ab69c44bea7f57d3.png" src="_images/2431728c621976f52ca15b45c321e0f5ac14e948774e7245ab69c44bea7f57d3.png" />
</div>
</div>
<p>Se observa como los datos predichos con el mejor orden según AIC con ARIMA con rolling vs. los esperados siguen una distribución bastante cercana a una recta de 45 grados.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d7</span> <span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">][:</span><span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">]][:</span><span class="mi">7</span><span class="p">])</span>
<span class="n">d14</span>  <span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">][:</span><span class="mi">14</span><span class="p">],</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">]][:</span><span class="mi">14</span><span class="p">])</span>
<span class="n">d21</span><span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">][:</span><span class="mi">21</span><span class="p">],</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">]][:</span><span class="mi">21</span><span class="p">])</span>
<span class="n">d28</span>  <span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">][:</span><span class="mi">28</span><span class="p">],</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">]][:</span><span class="mi">28</span><span class="p">])</span>

<span class="n">raic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Métrica&#39;</span><span class="p">:</span> <span class="n">d7</span><span class="p">[</span><span class="s1">&#39;Métrica&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 7&#39;</span><span class="p">:</span> <span class="n">d7</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 14&#39;</span><span class="p">:</span> <span class="n">d14</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 21&#39;</span><span class="p">:</span> <span class="n">d21</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 28&#39;</span><span class="p">:</span> <span class="n">d28</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">raic</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Métrica</th>
      <th>Días 7</th>
      <th>Días 14</th>
      <th>Días 21</th>
      <th>Días 28</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MAPE</td>
      <td>1.312539</td>
      <td>1.212652</td>
      <td>1.146243</td>
      <td>1.087074</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MAE</td>
      <td>1.121135</td>
      <td>1.064800</td>
      <td>1.014617</td>
      <td>0.955439</td>
    </tr>
    <tr>
      <th>2</th>
      <td>MSE</td>
      <td>1.777947</td>
      <td>1.431246</td>
      <td>1.402353</td>
      <td>1.324720</td>
    </tr>
    <tr>
      <th>3</th>
      <td>RMSE</td>
      <td>1.333397</td>
      <td>1.196347</td>
      <td>1.184210</td>
      <td>1.150965</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R2</td>
      <td>-0.108722</td>
      <td>0.822724</td>
      <td>0.802789</td>
      <td>0.835196</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Los resultados de las métricas de evaluación del modelo para 28 días reflejan una buena precisión en las predicciones. El <em>MAPE</em> es de 1.087, lo que indica que, en promedio, las predicciones difieren del valor real en aproximadamente un 1.09%. El <em>MAE</em> es de 0.955, mostrando que el error absoluto medio es de 0.96 unidades, mientras que el <em>MSE</em> es de 1.324, lo que refleja la magnitud promedio de los errores cuadráticos, sugiriendo que algunos errores grandes están afectando más el resultado. El <em>RMSE</em>, que ajusta los errores al nivel original de los datos, es de 1.151, lo que indica un error promedio de 1.15 unidades. Finalmente, el <em>R2</em> de 0.835 sugiere que el modelo explica el 83.5% de la variabilidad de los datos, lo que implica un buen ajuste.</p>
</section>
<section id="mathtt-arima-sin-rolling">
<h3><span class="math notranslate nohighlight">\(\mathtt{ARIMA\;sin\;rolling}\)</span><a class="headerlink" href="#mathtt-arima-sin-rolling" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">arima_no_rolling</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">best_order</span><span class="p">,</span> <span class="n">horizons</span><span class="p">):</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">predictions_dates</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">horizon</span> <span class="ow">in</span> <span class="n">horizons</span><span class="p">:</span>
        <span class="n">model_fit</span> <span class="o">=</span> <span class="n">fit_arima_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">best_order</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">model_fit</span><span class="p">:</span>
            <span class="n">predictions</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">horizon</span><span class="p">)</span>
            <span class="n">prediction_dates</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="n">horizon</span><span class="p">]</span>
            <span class="n">real_values</span> <span class="o">=</span> <span class="n">test</span><span class="p">[:</span><span class="n">horizon</span><span class="p">]</span>
            <span class="n">predictions_dates</span><span class="p">[</span><span class="n">horizon</span><span class="p">]</span> <span class="o">=</span> <span class="n">prediction_dates</span>
            <span class="n">results</span><span class="p">[</span><span class="n">horizon</span><span class="p">]</span> <span class="o">=</span> <span class="n">predictions</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al ajustar el modelo ARIMA para horizonte </span><span class="si">{</span><span class="n">horizon</span><span class="si">}</span><span class="s2"> días.&quot;</span><span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="n">horizon</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">for</span> <span class="n">horizon</span> <span class="ow">in</span> <span class="n">horizons</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">predictions_dates</span><span class="p">[</span><span class="n">horizon</span><span class="p">]):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">real_value</span> <span class="o">=</span> <span class="n">real_values</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">predicted_value</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">horizon</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">)]</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">real_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">      | </span><span class="si">{</span><span class="n">predicted_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error de índice en horizonte </span><span class="si">{</span><span class="n">horizon</span><span class="si">}</span><span class="s2">, posición </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">predictions_dates</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">horizons</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">28</span><span class="p">]</span>
<span class="n">results_no_rolling</span><span class="p">,</span> <span class="n">prediction_dates_no_rolling</span> <span class="o">=</span> <span class="n">arima_no_rolling</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;best_order_aic&#39;</span><span class="p">],</span> <span class="n">horizons</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-08-05 | 84.8500      | 87.4542
2024-08-06 | 84.6000      | 87.7389
2024-08-07 | 83.7000      | 87.6074
2024-08-08 | 85.4800      | 87.5688
2024-08-09 | 86.1200      | 87.3852
2024-08-12 | 86.6500      | 87.5196
2024-08-13 | 87.7600      | 87.6201
2024-08-05 | 84.8500      | 87.4542
2024-08-06 | 84.6000      | 87.7389
2024-08-07 | 83.7000      | 87.6074
2024-08-08 | 85.4800      | 87.5688
2024-08-09 | 86.1200      | 87.3852
2024-08-12 | 86.6500      | 87.5196
2024-08-13 | 87.7600      | 87.6201
2024-08-14 | 88.2600      | 87.6948
2024-08-15 | 89.1600      | 87.5598
2024-08-16 | 90.2300      | 87.4377
2024-08-19 | 91.2600      | 87.4636
2024-08-20 | 91.6200      | 87.5922
2024-08-21 | 92.6400      | 87.6980
2024-08-22 | 91.1300      | 87.5921
2024-08-05 | 84.8500      | 87.4542
2024-08-06 | 84.6000      | 87.7389
2024-08-07 | 83.7000      | 87.6074
2024-08-08 | 85.4800      | 87.5688
2024-08-09 | 86.1200      | 87.3852
2024-08-12 | 86.6500      | 87.5196
2024-08-13 | 87.7600      | 87.6201
2024-08-14 | 88.2600      | 87.6948
2024-08-15 | 89.1600      | 87.5598
2024-08-16 | 90.2300      | 87.4377
2024-08-19 | 91.2600      | 87.4636
2024-08-20 | 91.6200      | 87.5922
2024-08-21 | 92.6400      | 87.6980
2024-08-22 | 91.1300      | 87.5921
2024-08-23 | 92.2600      | 87.4813
2024-08-26 | 90.8600      | 87.4200
2024-08-27 | 90.8800      | 87.5773
2024-08-28 | 90.2100      | 87.6568
2024-08-29 | 90.3800      | 87.6591
2024-08-30 | 91.0100      | 87.4830
2024-09-03 | 88.6600      | 87.4468
2024-08-05 | 84.8500      | 87.4542
2024-08-06 | 84.6000      | 87.7389
2024-08-07 | 83.7000      | 87.6074
2024-08-08 | 85.4800      | 87.5688
2024-08-09 | 86.1200      | 87.3852
2024-08-12 | 86.6500      | 87.5196
2024-08-13 | 87.7600      | 87.6201
2024-08-14 | 88.2600      | 87.6948
2024-08-15 | 89.1600      | 87.5598
2024-08-16 | 90.2300      | 87.4377
2024-08-19 | 91.2600      | 87.4636
2024-08-20 | 91.6200      | 87.5922
2024-08-21 | 92.6400      | 87.6980
2024-08-22 | 91.1300      | 87.5921
2024-08-23 | 92.2600      | 87.4813
2024-08-26 | 90.8600      | 87.4200
2024-08-27 | 90.8800      | 87.5773
2024-08-28 | 90.2100      | 87.6568
2024-08-29 | 90.3800      | 87.6591
2024-08-30 | 91.0100      | 87.4830
2024-09-03 | 88.6600      | 87.4468
2024-09-04 | 86.2900      | 87.5028
2024-09-05 | 85.8300      | 87.6662
2024-09-06 | 84.9000      | 87.6523
2024-09-09 | 84.7100      | 87.5515
2024-09-10 | 85.1900      | 87.4272
2024-09-11 | 84.5600      | 87.4905
2024-09-12 | 84.9300      | 87.6138
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">horizons</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">28</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">horizon</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">horizons</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">]</span>
    
    <span class="n">dates_test</span> <span class="o">=</span> <span class="n">prediction_dates_no_rolling</span><span class="p">[</span><span class="n">horizon</span><span class="p">]</span>
    <span class="n">test_values</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dates_test</span><span class="p">]</span>
    <span class="n">predicted_values</span> <span class="o">=</span> <span class="n">results_no_rolling</span><span class="p">[</span><span class="n">horizon</span><span class="p">]</span>

    <span class="n">train_dates</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">index</span>
    <span class="n">train_values</span> <span class="o">=</span> <span class="n">train</span>
    
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">train_dates</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:],</span> <span class="n">y</span><span class="o">=</span><span class="n">train_values</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#00008B&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">dates_test</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">test_values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#32a850&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">dates_test</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">predicted_values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Forecast&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#a83264&#39;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Horizonte de </span><span class="si">{</span><span class="n">horizon</span><span class="si">}</span><span class="s1"> días&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Ajustar el diseño para evitar solapamientos</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/084211749813139850edffd4fa3320cb203c06a9aa258f37fdc882b60048aab4.png" src="_images/084211749813139850edffd4fa3320cb203c06a9aa258f37fdc882b60048aab4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">comparison_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Real&#39;</span><span class="p">:</span> <span class="n">test_values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
    <span class="s1">&#39;Predicted&#39;</span><span class="p">:</span> <span class="n">results_no_rolling</span><span class="p">[</span><span class="mi">28</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="p">})</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">comparison_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Predicted&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="n">min_val</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Real&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Predicted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">max_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Real&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Predicted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span> <span class="p">[</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Comparación entre Valores Reales y Predicciones&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Valor Real&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Valor Predicho&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7d35628aad739fc6a46eb6c2606d42b4bd7980ee2a386ce1b5f7d0efa66ca348.png" src="_images/7d35628aad739fc6a46eb6c2606d42b4bd7980ee2a386ce1b5f7d0efa66ca348.png" />
</div>
</div>
<p>La gráfica de correlación para los valores predichos con los esperados del conjunto de test para ARIMA (AIC) sin rolling no se ve para nada bien, los valores obtenidos de las predicciones son todos muy similares, tal como se observa en las cuatro gráficas de arriba, cuyas predicciones siguen una distribución practicamente lineal (180 grados).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d7</span> <span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_values</span><span class="p">[:</span><span class="mi">7</span><span class="p">],</span> <span class="n">predicted_values</span><span class="p">[:</span><span class="mi">7</span><span class="p">])</span>
<span class="n">d14</span>  <span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_values</span><span class="p">[:</span><span class="mi">14</span><span class="p">],</span> <span class="n">predicted_values</span><span class="p">[:</span><span class="mi">14</span><span class="p">])</span>
<span class="n">d21</span><span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_values</span><span class="p">[:</span><span class="mi">21</span><span class="p">],</span> <span class="n">predicted_values</span><span class="p">[:</span><span class="mi">21</span><span class="p">])</span>
<span class="n">d28</span>  <span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_values</span><span class="p">[:</span><span class="mi">28</span><span class="p">],</span> <span class="n">predicted_values</span><span class="p">[:</span><span class="mi">28</span><span class="p">])</span>

<span class="n">nraic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Métrica&#39;</span><span class="p">:</span> <span class="n">d7</span><span class="p">[</span><span class="s1">&#39;Métrica&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 7&#39;</span><span class="p">:</span> <span class="n">d7</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 14&#39;</span><span class="p">:</span> <span class="n">d14</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 21&#39;</span><span class="p">:</span> <span class="n">d21</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 28&#39;</span><span class="p">:</span> <span class="n">d28</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">nraic</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Métrica</th>
      <th>Días 7</th>
      <th>Días 14</th>
      <th>Días 21</th>
      <th>Días 28</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MAPE</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MAE</td>
      <td>2.002013</td>
      <td>2.519703</td>
      <td>2.705316</td>
      <td>2.618068</td>
    </tr>
    <tr>
      <th>2</th>
      <td>MSE</td>
      <td>5.520341</td>
      <td>8.349668</td>
      <td>9.062227</td>
      <td>8.271219</td>
    </tr>
    <tr>
      <th>3</th>
      <td>RMSE</td>
      <td>2.349541</td>
      <td>2.889579</td>
      <td>3.010353</td>
      <td>2.875973</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R2</td>
      <td>-2.442467</td>
      <td>-0.034200</td>
      <td>-0.274406</td>
      <td>-0.028992</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El <em>MAE</em> es de 2.618, lo que significa que, en promedio, las predicciones a 28 días difieren de los valores reales en 2.62 unidades. El <em>MSE</em>, que mide los errores cuadráticos, es de 8.271, lo que sugiere la presencia de errores relativamente grandes. El RMSE, que es la raíz cuadrada del <em>MSE</em>, es de 2.876, indicando que el error promedio en las predicciones es alto. Finalmente, el R2 es negativo (-0.029), lo que implica que el modelo no explica la variabilidad de los datos, siendo incluso peor que simplemente predecir el valor promedio. Esto indica un ajuste deficiente del modelo.</p>
</section>
<section id="mathtt-normalidad-e-independencia-de-los-residuos">
<h3><span class="math notranslate nohighlight">\(\mathtt{Normalidad\;e\;independencia\;de\;los\;residuos}\)</span><a class="headerlink" href="#mathtt-normalidad-e-independencia-de-los-residuos" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modeloaic</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">order</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;best_order_hqic&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">)})</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">plot_predict</span><span class="p">(</span><span class="n">modeloaic</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b067d4606abc78b7c5807ed106aa88b37c58fe5b8ca434a19b1271eea22ac1ac.png" src="_images/b067d4606abc78b7c5807ed106aa88b37c58fe5b8ca434a19b1271eea22ac1ac.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modeloaic</span><span class="o">.</span><span class="n">plot_diagnostics</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/278996f66c1ae6a48a6938ce4c3fc87b3d1a3c72befefc5c71fe5625655587d3.png" src="_images/278996f66c1ae6a48a6938ce4c3fc87b3d1a3c72befefc5c71fe5625655587d3.png" />
</div>
</div>
<p>El primer gráfico muestra los residuos (diferencia entre los valores observados y los valores ajustados) frente a los valores ajustados. Idealmente, los residuos deben estar distribuidos aleatoriamente alrededor de cero y no mostrar ningún patrón sistemático, sin embargo, en la gráfica en bastantes observaciones estos residuos difieren bastante de 0.</p>
<p>El segundo gráfico, histograma, muestra la distribución de los residuos en un histograma. La distribución debería parecerse a una distribución normal, con una forma de campana simétrica alrededor de cero. Un histograma muy asimétrico o sesgado indica que los residuos no están distribuidos normalmente. Tal como se observa en la gráfica, estos residuos no siguen una distribución normal, lo cual es confirmado con el tercer gráfico: Q-Q plot.</p>
<p>En cuanto a la cuarta gráfica, el correlograma, no se observa autocorrelación significativa en los diferentes retardos (lags). En el gráfico, las barras que se extienden más allá de las bandas de confianza indican autocorrelación en esos retardos, lo que sugiere que el modelo puede no estar capturando todas las dependencias en los datos, sin embargo, esto no se presenta para este modelo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resid_clean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">modeloaic</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">stat</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">shapiro</span><span class="p">(</span><span class="n">resid_clean</span><span class="p">)</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Normal&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No normal&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Statistics=</span><span class="si">%.3f</span><span class="s1">, p=</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No normal
Statistics=0.777, p=0.000
</pre></div>
</div>
</div>
</div>
<p>Esto confirma que los residuos no siguen una distribución normal, tal como se observaba en el histograma y los Q-Q plots.</p>
</section>
</section>
<section id="mathtt-arima-bic">
<h2><span class="math notranslate nohighlight">\(\mathtt{ARIMA:\;BIC}\)</span><a class="headerlink" href="#mathtt-arima-bic" title="Link to this heading">#</a></h2>
<section id="id1">
<h3><span class="math notranslate nohighlight">\(\mathtt{ARIMA \; con\;rolling}\)</span><a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">horizons</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">28</span><span class="p">]</span>
<span class="n">results_rolling</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">horizons</span><span class="p">:</span>
    <span class="n">results_rolling</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">arima_rolling</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="n">test</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;best_order_bic&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>predicted=87.510002, expected=84.849998
predicted=84.849998, expected=84.599998
predicted=84.599998, expected=83.699997
predicted=83.699997, expected=85.480003
predicted=85.480003, expected=86.120003
predicted=86.120003, expected=86.650002
predicted=86.650002, expected=87.760002
predicted=87.510002, expected=84.849998
predicted=84.849998, expected=84.599998
predicted=84.599998, expected=83.699997
predicted=83.699997, expected=85.480003
predicted=85.480003, expected=86.120003
predicted=86.120003, expected=86.650002
predicted=86.650002, expected=87.760002
predicted=87.760002, expected=88.260002
predicted=88.260002, expected=89.160004
predicted=89.160004, expected=90.230003
predicted=90.230003, expected=91.260002
predicted=91.260002, expected=91.620003
predicted=91.620003, expected=92.639999
predicted=92.639999, expected=91.129997
predicted=87.510002, expected=84.849998
predicted=84.849998, expected=84.599998
predicted=84.599998, expected=83.699997
predicted=83.699997, expected=85.480003
predicted=85.480003, expected=86.120003
predicted=86.120003, expected=86.650002
predicted=86.650002, expected=87.760002
predicted=87.760002, expected=88.260002
predicted=88.260002, expected=89.160004
predicted=89.160004, expected=90.230003
predicted=90.230003, expected=91.260002
predicted=91.260002, expected=91.620003
predicted=91.620003, expected=92.639999
predicted=92.639999, expected=91.129997
predicted=91.129997, expected=92.260002
predicted=92.260002, expected=90.860001
predicted=90.860001, expected=90.879997
predicted=90.879997, expected=90.209999
predicted=90.209999, expected=90.379997
predicted=90.379997, expected=91.010002
predicted=91.010002, expected=88.660004
predicted=87.510002, expected=84.849998
predicted=84.849998, expected=84.599998
predicted=84.599998, expected=83.699997
predicted=83.699997, expected=85.480003
predicted=85.480003, expected=86.120003
predicted=86.120003, expected=86.650002
predicted=86.650002, expected=87.760002
predicted=87.760002, expected=88.260002
predicted=88.260002, expected=89.160004
predicted=89.160004, expected=90.230003
predicted=90.230003, expected=91.260002
predicted=91.260002, expected=91.620003
predicted=91.620003, expected=92.639999
predicted=92.639999, expected=91.129997
predicted=91.129997, expected=92.260002
predicted=92.260002, expected=90.860001
predicted=90.860001, expected=90.879997
predicted=90.879997, expected=90.209999
predicted=90.209999, expected=90.379997
predicted=90.379997, expected=91.010002
predicted=91.010002, expected=88.660004
predicted=88.660004, expected=86.290001
predicted=86.290001, expected=85.830002
predicted=85.830002, expected=84.900002
predicted=84.900002, expected=84.709999
predicted=84.709999, expected=85.190002
predicted=85.190002, expected=84.559998
predicted=84.559998, expected=84.930000
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">horizons</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">28</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">horizon</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">horizons</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">]</span>

    <span class="n">dates_test</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[:</span><span class="n">horizon</span><span class="p">]</span>
    <span class="n">predicted_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">results_rolling</span><span class="p">[</span><span class="n">horizon</span><span class="p">]]</span>
    
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Test&#39;</span><span class="p">:</span> <span class="n">test</span><span class="p">[:</span><span class="n">horizon</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">test</span><span class="p">[:</span><span class="n">horizon</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="n">pred_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Date&#39;</span><span class="p">:</span> <span class="n">dates_test</span><span class="p">,</span>
        <span class="s1">&#39;Forecast&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">predicted_values</span><span class="p">)</span>
    <span class="p">})</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>

    
    <span class="n">train_dates</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">index</span>
    <span class="n">train_values</span> <span class="o">=</span> <span class="n">train</span>
    
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">train_dates</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:],</span> <span class="n">y</span><span class="o">=</span><span class="n">train_values</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#00008B&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">pred_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#32a850&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">pred_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">]],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Forecast&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#a83264&#39;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Horizonte de </span><span class="si">{</span><span class="n">horizon</span><span class="si">}</span><span class="s1"> días&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f94c6bab5e49a55b25da15f4701a9cb6fa9942223ef536493a8cb0d44a005150.png" src="_images/f94c6bab5e49a55b25da15f4701a9cb6fa9942223ef536493a8cb0d44a005150.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">comparison_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Real&#39;</span><span class="p">:</span> <span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Predicted&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">]]</span>
<span class="p">})</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">comparison_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Predicted&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="n">min_val</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Real&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Predicted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">max_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Real&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Predicted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span> <span class="p">[</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Comparación entre Valores Reales y Predicciones&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Valor Real&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Valor Predicho&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5451313701c2b0c32cdcaf891dc2511e696e9f61e36773f6390f72ac3d37509b.png" src="_images/5451313701c2b0c32cdcaf891dc2511e696e9f61e36773f6390f72ac3d37509b.png" />
</div>
</div>
<p>Se observa como los datos predichos con el mejor orden según BIC con ARIMA con rolling vs. los esperados siguen una distribución bastante cercana a una recta de 45 grados.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d7</span> <span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">][:</span><span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">]][:</span><span class="mi">7</span><span class="p">])</span>
<span class="n">d14</span>  <span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">][:</span><span class="mi">14</span><span class="p">],</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">]][:</span><span class="mi">14</span><span class="p">])</span>
<span class="n">d21</span><span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">][:</span><span class="mi">21</span><span class="p">],</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">]][:</span><span class="mi">21</span><span class="p">])</span>
<span class="n">d28</span>  <span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">][:</span><span class="mi">28</span><span class="p">],</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">]][:</span><span class="mi">28</span><span class="p">])</span>

<span class="n">rbic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Métrica&#39;</span><span class="p">:</span> <span class="n">d7</span><span class="p">[</span><span class="s1">&#39;Métrica&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 7&#39;</span><span class="p">:</span> <span class="n">d7</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 14&#39;</span><span class="p">:</span> <span class="n">d14</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 21&#39;</span><span class="p">:</span> <span class="n">d21</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 28&#39;</span><span class="p">:</span> <span class="n">d28</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">rbic</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Métrica</th>
      <th>Días 7</th>
      <th>Días 14</th>
      <th>Días 21</th>
      <th>Días 28</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MAPE</td>
      <td>1.315387</td>
      <td>1.160648</td>
      <td>1.110016</td>
      <td>1.059167</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MAE</td>
      <td>1.124287</td>
      <td>1.018572</td>
      <td>0.982382</td>
      <td>0.930715</td>
    </tr>
    <tr>
      <th>2</th>
      <td>MSE</td>
      <td>1.862735</td>
      <td>1.411075</td>
      <td>1.399503</td>
      <td>1.317260</td>
    </tr>
    <tr>
      <th>3</th>
      <td>RMSE</td>
      <td>1.364820</td>
      <td>1.187887</td>
      <td>1.183006</td>
      <td>1.147719</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R2</td>
      <td>-0.161595</td>
      <td>0.825223</td>
      <td>0.803190</td>
      <td>0.836125</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Los resultados indican que para la predicción a 28 días el modelo tiene un rendimiento decente en las predicciones. El <em>MAPE</em> es de 1.06%, lo que significa que el error absoluto porcentual promedio es bajo, indicando buenas predicciones en términos relativos. El <em>MAE</em> es de 0.93, lo que sugiere que, en promedio, las predicciones difieren de los valores reales en menos de una unidad. El <em>MSE</em>, que mide los errores cuadráticos, es de 1.32, mientras que el <em>RMSE</em> es de 1.15, lo que indica que los errores promedio son bajos en términos absolutos. Finalmente, el <em>R2</em> de 0.836 indica que el modelo explica el 83.6% de la variabilidad de los datos, lo que sugiere un buen ajuste del modelo.</p>
</section>
<section id="id2">
<h3><span class="math notranslate nohighlight">\(\mathtt{ARIMA \; sin\;rolling}\)</span><a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">horizons</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">28</span><span class="p">]</span>
<span class="n">results_no_rolling</span><span class="p">,</span> <span class="n">prediction_dates_no_rolling</span> <span class="o">=</span> <span class="n">arima_no_rolling</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;best_order_bic&#39;</span><span class="p">],</span> <span class="n">horizons</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-08-05 | 84.8500      | 87.5100
2024-08-06 | 84.6000      | 87.5100
2024-08-07 | 83.7000      | 87.5100
2024-08-08 | 85.4800      | 87.5100
2024-08-09 | 86.1200      | 87.5100
2024-08-12 | 86.6500      | 87.5100
2024-08-13 | 87.7600      | 87.5100
2024-08-05 | 84.8500      | 87.5100
2024-08-06 | 84.6000      | 87.5100
2024-08-07 | 83.7000      | 87.5100
2024-08-08 | 85.4800      | 87.5100
2024-08-09 | 86.1200      | 87.5100
2024-08-12 | 86.6500      | 87.5100
2024-08-13 | 87.7600      | 87.5100
2024-08-14 | 88.2600      | 87.5100
2024-08-15 | 89.1600      | 87.5100
2024-08-16 | 90.2300      | 87.5100
2024-08-19 | 91.2600      | 87.5100
2024-08-20 | 91.6200      | 87.5100
2024-08-21 | 92.6400      | 87.5100
2024-08-22 | 91.1300      | 87.5100
2024-08-05 | 84.8500      | 87.5100
2024-08-06 | 84.6000      | 87.5100
2024-08-07 | 83.7000      | 87.5100
2024-08-08 | 85.4800      | 87.5100
2024-08-09 | 86.1200      | 87.5100
2024-08-12 | 86.6500      | 87.5100
2024-08-13 | 87.7600      | 87.5100
2024-08-14 | 88.2600      | 87.5100
2024-08-15 | 89.1600      | 87.5100
2024-08-16 | 90.2300      | 87.5100
2024-08-19 | 91.2600      | 87.5100
2024-08-20 | 91.6200      | 87.5100
2024-08-21 | 92.6400      | 87.5100
2024-08-22 | 91.1300      | 87.5100
2024-08-23 | 92.2600      | 87.5100
2024-08-26 | 90.8600      | 87.5100
2024-08-27 | 90.8800      | 87.5100
2024-08-28 | 90.2100      | 87.5100
2024-08-29 | 90.3800      | 87.5100
2024-08-30 | 91.0100      | 87.5100
2024-09-03 | 88.6600      | 87.5100
2024-08-05 | 84.8500      | 87.5100
2024-08-06 | 84.6000      | 87.5100
2024-08-07 | 83.7000      | 87.5100
2024-08-08 | 85.4800      | 87.5100
2024-08-09 | 86.1200      | 87.5100
2024-08-12 | 86.6500      | 87.5100
2024-08-13 | 87.7600      | 87.5100
2024-08-14 | 88.2600      | 87.5100
2024-08-15 | 89.1600      | 87.5100
2024-08-16 | 90.2300      | 87.5100
2024-08-19 | 91.2600      | 87.5100
2024-08-20 | 91.6200      | 87.5100
2024-08-21 | 92.6400      | 87.5100
2024-08-22 | 91.1300      | 87.5100
2024-08-23 | 92.2600      | 87.5100
2024-08-26 | 90.8600      | 87.5100
2024-08-27 | 90.8800      | 87.5100
2024-08-28 | 90.2100      | 87.5100
2024-08-29 | 90.3800      | 87.5100
2024-08-30 | 91.0100      | 87.5100
2024-09-03 | 88.6600      | 87.5100
2024-09-04 | 86.2900      | 87.5100
2024-09-05 | 85.8300      | 87.5100
2024-09-06 | 84.9000      | 87.5100
2024-09-09 | 84.7100      | 87.5100
2024-09-10 | 85.1900      | 87.5100
2024-09-11 | 84.5600      | 87.5100
2024-09-12 | 84.9300      | 87.5100
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">horizons</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">28</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">horizon</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">horizons</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">]</span>
    
    <span class="n">dates_test</span> <span class="o">=</span> <span class="n">prediction_dates_no_rolling</span><span class="p">[</span><span class="n">horizon</span><span class="p">]</span>
    <span class="n">test_values</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dates_test</span><span class="p">]</span>
    <span class="n">predicted_values</span> <span class="o">=</span> <span class="n">results_no_rolling</span><span class="p">[</span><span class="n">horizon</span><span class="p">]</span>

    <span class="n">train_dates</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">index</span>
    <span class="n">train_values</span> <span class="o">=</span> <span class="n">train</span>
    
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">train_dates</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:],</span> <span class="n">y</span><span class="o">=</span><span class="n">train_values</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#00008B&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">dates_test</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">test_values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#32a850&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">dates_test</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">predicted_values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Forecast&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#a83264&#39;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Horizonte de </span><span class="si">{</span><span class="n">horizon</span><span class="si">}</span><span class="s1"> días&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1d6e8981b2af426583243fff96b0f74898a7cfdc035b731fd584ca6ba7119a8b.png" src="_images/1d6e8981b2af426583243fff96b0f74898a7cfdc035b731fd584ca6ba7119a8b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">comparison_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Real&#39;</span><span class="p">:</span> <span class="n">test_values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
    <span class="s1">&#39;Predicted&#39;</span><span class="p">:</span> <span class="n">results_no_rolling</span><span class="p">[</span><span class="mi">28</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="p">})</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">comparison_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Predicted&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="n">min_val</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Real&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Predicted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">max_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Real&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Predicted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span> <span class="p">[</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Comparación entre Valores Reales y Predicciones&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Valor Real&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Valor Predicho&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f57fb1b7b72ac3049d49b1700b697c26ccc7899855b4141767c8fa803f225436.png" src="_images/f57fb1b7b72ac3049d49b1700b697c26ccc7899855b4141767c8fa803f225436.png" />
</div>
</div>
<p>La gráfica de correlación para los valores predichos con los esperados del conjunto de test para ARIMA (AIC) sin rolling no se ve para nada bien, los valores obtenidos de las predicciones son todos muy similares, tal como se observa en las cuatro gráficas de arriba, cuyas predicciones siguen una distribución practicamente lineal (180 grados).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d7</span> <span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_values</span><span class="p">[:</span><span class="mi">7</span><span class="p">],</span> <span class="n">predicted_values</span><span class="p">[:</span><span class="mi">7</span><span class="p">])</span>
<span class="n">d14</span>  <span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_values</span><span class="p">[:</span><span class="mi">14</span><span class="p">],</span> <span class="n">predicted_values</span><span class="p">[:</span><span class="mi">14</span><span class="p">])</span>
<span class="n">d21</span><span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_values</span><span class="p">[:</span><span class="mi">21</span><span class="p">],</span> <span class="n">predicted_values</span><span class="p">[:</span><span class="mi">21</span><span class="p">])</span>
<span class="n">d28</span>  <span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_values</span><span class="p">[:</span><span class="mi">28</span><span class="p">],</span> <span class="n">predicted_values</span><span class="p">[:</span><span class="mi">28</span><span class="p">])</span>

<span class="n">nrbic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Métrica&#39;</span><span class="p">:</span> <span class="n">d7</span><span class="p">[</span><span class="s1">&#39;Métrica&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 7&#39;</span><span class="p">:</span> <span class="n">d7</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 14&#39;</span><span class="p">:</span> <span class="n">d14</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 21&#39;</span><span class="p">:</span> <span class="n">d21</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 28&#39;</span><span class="p">:</span> <span class="n">d28</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">nrbic</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Métrica</th>
      <th>Días 7</th>
      <th>Días 14</th>
      <th>Días 21</th>
      <th>Días 28</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MAPE</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MAE</td>
      <td>1.987144</td>
      <td>2.545715</td>
      <td>2.730000</td>
      <td>2.624643</td>
    </tr>
    <tr>
      <th>2</th>
      <td>MSE</td>
      <td>5.273568</td>
      <td>8.426731</td>
      <td>9.153116</td>
      <td>8.282847</td>
    </tr>
    <tr>
      <th>3</th>
      <td>RMSE</td>
      <td>2.296425</td>
      <td>2.902883</td>
      <td>3.025412</td>
      <td>2.877993</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R2</td>
      <td>-2.288580</td>
      <td>-0.043745</td>
      <td>-0.287187</td>
      <td>-0.030439</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Los resultados sugieren que el modelo para 28 días tiene un rendimiento deficiente. El <em>MAE</em> es de 2.62, lo que significa que el error absoluto promedio es relativamente alto. El <em>MSE</em> de 8.28 y el RMSE de 2.88 reflejan errores grandes en las predicciones en comparación con los valores reales. El <em>R2</em> es negativo (-0.03), lo que indica que el modelo no es capaz de explicar la variabilidad de los datos y, en realidad, es peor que una predicción basada en la media.</p>
</section>
<section id="id3">
<h3><span class="math notranslate nohighlight">\(\mathtt{Normalidad\;e\;independencia\;de\;los\;residuos}\)</span><a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modelobic</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">order</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;best_order_bic&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">)})</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">plot_predict</span><span class="p">(</span><span class="n">modelobic</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/cd3f322c38e16ab22b7d178d7f52aa6984294bd9898db830d1d8b3692afdaea0.png" src="_images/cd3f322c38e16ab22b7d178d7f52aa6984294bd9898db830d1d8b3692afdaea0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modelobic</span><span class="o">.</span><span class="n">plot_diagnostics</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c11562024087c23a7243d3deaccc08e858f77d79488a4743e9c49f94ad23076b.png" src="_images/c11562024087c23a7243d3deaccc08e858f77d79488a4743e9c49f94ad23076b.png" />
</div>
</div>
<p>El primer gráfico muestra los residuos (diferencia entre los valores observados y los valores ajustados) frente a los valores ajustados. Idealmente, los residuos deben estar distribuidos aleatoriamente alrededor de cero y no mostrar ningún patrón sistemático, sin embargo, en la gráfica en bastantes observaciones estos residuos difieren bastante de 0.</p>
<p>El segundo gráfico, histograma, muestra la distribución de los residuos en un histograma. La distribución debería parecerse a una distribución normal, con una forma de campana simétrica alrededor de cero. Un histograma muy asimétrico o sesgado indica que los residuos no están distribuidos normalmente. Tal como se observa en la gráfica, estos residuos no siguen una distribución normal, lo cual es confirmado con el tercer gráfico: Q-Q plot.</p>
<p>En cuanto a la cuarta gráfica, el correlograma, no se observa autocorrelación significativa en los diferentes retardos (lags). En el gráfico, las barras que se extienden más allá de las bandas de confianza indican autocorrelación en esos retardos, lo que sugiere que el modelo puede no estar capturando todas las dependencias en los datos, sin embargo, esto no se presenta para este modelo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resid_clean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">modelobic</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">stat</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">shapiro</span><span class="p">(</span><span class="n">resid_clean</span><span class="p">)</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Normal&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No normal&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Statistics=</span><span class="si">%.3f</span><span class="s1">, p=</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No normal
Statistics=0.770, p=0.000
</pre></div>
</div>
</div>
</div>
<p>Esto confirma que los residuos no siguen una distribución normal, tal como se observaba en el histograma y los Q-Q plots.</p>
</section>
</section>
<section id="mathtt-arima-hqic">
<h2><span class="math notranslate nohighlight">\(\mathtt{ARIMA:\;HQIC}\)</span><a class="headerlink" href="#mathtt-arima-hqic" title="Link to this heading">#</a></h2>
<section id="id4">
<h3><span class="math notranslate nohighlight">\(\mathtt{ARIMA \; con\;rolling}\)</span><a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">horizons</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">28</span><span class="p">]</span>
<span class="n">results_rolling</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">horizons</span><span class="p">:</span>
    <span class="n">results_rolling</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">arima_rolling</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="n">test</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;best_order_hqic&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>predicted=87.540915, expected=84.849998
predicted=0.000000, expected=84.599998
predicted=84.738930, expected=83.699997
predicted=83.834252, expected=85.480003
predicted=85.511683, expected=86.120003
predicted=86.043793, expected=86.650002
predicted=86.498993, expected=87.760002
predicted=87.540915, expected=84.849998
predicted=0.000000, expected=84.599998
predicted=84.738930, expected=83.699997
predicted=83.834252, expected=85.480003
predicted=85.511683, expected=86.120003
predicted=86.043793, expected=86.650002
predicted=86.498993, expected=87.760002
predicted=87.679529, expected=88.260002
predicted=88.031198, expected=89.160004
predicted=88.948909, expected=90.230003
predicted=90.056308, expected=91.260002
predicted=91.141990, expected=91.620003
predicted=91.585299, expected=92.639999
predicted=92.669868, expected=91.129997
predicted=87.540915, expected=84.849998
predicted=0.000000, expected=84.599998
predicted=84.738930, expected=83.699997
predicted=83.834252, expected=85.480003
predicted=85.511683, expected=86.120003
predicted=86.043793, expected=86.650002
predicted=86.498993, expected=87.760002
predicted=87.679529, expected=88.260002
predicted=88.031198, expected=89.160004
predicted=88.948909, expected=90.230003
predicted=90.056308, expected=91.260002
predicted=91.141990, expected=91.620003
predicted=91.585299, expected=92.639999
predicted=92.669868, expected=91.129997
predicted=91.273876, expected=92.260002
predicted=92.436531, expected=90.860001
predicted=91.077807, expected=90.879997
predicted=91.084832, expected=90.209999
predicted=90.374222, expected=90.379997
predicted=90.461284, expected=91.010002
predicted=90.976195, expected=88.660004
predicted=87.540915, expected=84.849998
predicted=0.000000, expected=84.599998
predicted=84.738930, expected=83.699997
predicted=83.834252, expected=85.480003
predicted=85.511683, expected=86.120003
predicted=86.043793, expected=86.650002
predicted=86.498993, expected=87.760002
predicted=87.679529, expected=88.260002
predicted=88.031198, expected=89.160004
predicted=88.948909, expected=90.230003
predicted=90.056308, expected=91.260002
predicted=91.141990, expected=91.620003
predicted=91.585299, expected=92.639999
predicted=92.669868, expected=91.129997
predicted=91.273876, expected=92.260002
predicted=92.436531, expected=90.860001
predicted=91.077807, expected=90.879997
predicted=91.084832, expected=90.209999
predicted=90.374222, expected=90.379997
predicted=90.461284, expected=91.010002
predicted=90.976195, expected=88.660004
predicted=88.616951, expected=86.290001
predicted=86.295860, expected=85.830002
predicted=85.844586, expected=84.900002
predicted=84.919942, expected=84.709999
predicted=84.721430, expected=85.190002
predicted=85.164482, expected=84.559998
predicted=84.529765, expected=84.930000
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">horizons</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">28</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">horizon</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">horizons</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">]</span>

    <span class="n">dates_test</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[:</span><span class="n">horizon</span><span class="p">]</span>
    <span class="n">predicted_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">results_rolling</span><span class="p">[</span><span class="n">horizon</span><span class="p">]]</span>
    
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Test&#39;</span><span class="p">:</span> <span class="n">test</span><span class="p">[:</span><span class="n">horizon</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">test</span><span class="p">[:</span><span class="n">horizon</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="n">pred_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Date&#39;</span><span class="p">:</span> <span class="n">dates_test</span><span class="p">,</span>
        <span class="s1">&#39;Forecast&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">predicted_values</span><span class="p">)</span>
    <span class="p">})</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>

    
    <span class="n">train_dates</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">index</span>
    <span class="n">train_values</span> <span class="o">=</span> <span class="n">train</span>
    
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">train_dates</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:],</span> <span class="n">y</span><span class="o">=</span><span class="n">train_values</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#00008B&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">pred_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#32a850&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">pred_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">]],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Forecast&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#a83264&#39;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Horizonte de </span><span class="si">{</span><span class="n">horizon</span><span class="si">}</span><span class="s1"> días&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f71e49cef7199d5d5649ff293fad66daa9497ed123883d727d71af4a9a4a17b3.png" src="_images/f71e49cef7199d5d5649ff293fad66daa9497ed123883d727d71af4a9a4a17b3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">comparison_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Real&#39;</span><span class="p">:</span> <span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Predicted&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">]]</span>
<span class="p">})</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">comparison_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Predicted&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="n">min_val</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Real&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Predicted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">max_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Real&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Predicted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span> <span class="p">[</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Comparación entre Valores Reales y Predicciones&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Valor Real&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Valor Predicho&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/43cc0e629d8196be7aa49285d3616b21db0e17113ce79b35b8a39fe879be0371.png" src="_images/43cc0e629d8196be7aa49285d3616b21db0e17113ce79b35b8a39fe879be0371.png" />
</div>
</div>
<p>Hubo un día muy mal ajustada por el modelo que daña todas las métricas tenidas en cuenta. Predice un valor de 0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d7</span> <span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">][:</span><span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">]][:</span><span class="mi">7</span><span class="p">])</span>
<span class="n">d14</span>  <span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">][:</span><span class="mi">14</span><span class="p">],</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">]][:</span><span class="mi">14</span><span class="p">])</span>
<span class="n">d21</span><span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">][:</span><span class="mi">21</span><span class="p">],</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">]][:</span><span class="mi">21</span><span class="p">])</span>
<span class="n">d28</span>  <span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">][:</span><span class="mi">28</span><span class="p">],</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">]][:</span><span class="mi">28</span><span class="p">])</span>

<span class="n">rhqic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Métrica&#39;</span><span class="p">:</span> <span class="n">d7</span><span class="p">[</span><span class="s1">&#39;Métrica&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 7&#39;</span><span class="p">:</span> <span class="n">d7</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 14&#39;</span><span class="p">:</span> <span class="n">d14</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 21&#39;</span><span class="p">:</span> <span class="n">d21</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 28&#39;</span><span class="p">:</span> <span class="n">d28</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">rhqic</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Métrica</th>
      <th>Días 7</th>
      <th>Días 14</th>
      <th>Días 21</th>
      <th>Días 28</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MAPE</td>
      <td>15.597257</td>
      <td>8.370949</td>
      <td>5.924117</td>
      <td>4.669373</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MAE</td>
      <td>13.207305</td>
      <td>7.122699</td>
      <td>5.058275</td>
      <td>3.987300</td>
    </tr>
    <tr>
      <th>2</th>
      <td>MSE</td>
      <td>1024.359477</td>
      <td>512.780690</td>
      <td>342.326566</td>
      <td>257.006110</td>
    </tr>
    <tr>
      <th>3</th>
      <td>RMSE</td>
      <td>32.005616</td>
      <td>22.644661</td>
      <td>18.502069</td>
      <td>16.031410</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R2</td>
      <td>-637.787237</td>
      <td>-62.513607</td>
      <td>-47.140810</td>
      <td>-30.973186</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Los resultados muestran que el modelo tiene un rendimiento extremadamente pobre para la predicción tanto de 7, 14, 21 y 28 días. En el caso de 28 días, el <em>MAPE</em> de 4.67 indica que el error porcentual promedio es muy elevado, lo que significa que las predicciones están lejos de los valores reales. El <em>MAE</em> de 3.99 también refleja un error absoluto considerable en las predicciones. El <em>MSE</em>, con un valor de 257, y el <em>RMSE</em> de 16.03 sugieren grandes discrepancias entre las predicciones y los datos reales. Además, el <em>R2</em> negativo (-30.97) indica que el modelo no solo no explica la variabilidad de los datos, sino que está mucho peor que si se utilizara simplemente la media de los valores reales para hacer predicciones.</p>
</section>
<section id="id5">
<h3><span class="math notranslate nohighlight">\(\mathtt{ARIMA \; sin\;rolling}\)</span><a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">horizons</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">28</span><span class="p">]</span>
<span class="n">results_no_rolling</span><span class="p">,</span> <span class="n">prediction_dates_no_rolling</span> <span class="o">=</span> <span class="n">arima_no_rolling</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;best_order_hqic&#39;</span><span class="p">],</span> <span class="n">horizons</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-08-05 | 84.8500      | 87.5409
2024-08-06 | 84.6000      | 87.5615
2024-08-07 | 83.7000      | 87.5665
2024-08-08 | 85.4800      | 87.5570
2024-08-09 | 86.1200      | 87.5367
2024-08-12 | 86.6500      | 87.5112
2024-08-13 | 87.7600      | 87.4862
2024-08-05 | 84.8500      | 87.5409
2024-08-06 | 84.6000      | 87.5615
2024-08-07 | 83.7000      | 87.5665
2024-08-08 | 85.4800      | 87.5570
2024-08-09 | 86.1200      | 87.5367
2024-08-12 | 86.6500      | 87.5112
2024-08-13 | 87.7600      | 87.4862
2024-08-14 | 88.2600      | 87.4669
2024-08-15 | 89.1600      | 87.4563
2024-08-16 | 90.2300      | 87.4554
2024-08-19 | 91.2600      | 87.4632
2024-08-20 | 91.6200      | 87.4769
2024-08-21 | 92.6400      | 87.4931
2024-08-22 | 91.1300      | 87.5080
2024-08-05 | 84.8500      | 87.5409
2024-08-06 | 84.6000      | 87.5615
2024-08-07 | 83.7000      | 87.5665
2024-08-08 | 85.4800      | 87.5570
2024-08-09 | 86.1200      | 87.5367
2024-08-12 | 86.6500      | 87.5112
2024-08-13 | 87.7600      | 87.4862
2024-08-14 | 88.2600      | 87.4669
2024-08-15 | 89.1600      | 87.4563
2024-08-16 | 90.2300      | 87.4554
2024-08-19 | 91.2600      | 87.4632
2024-08-20 | 91.6200      | 87.4769
2024-08-21 | 92.6400      | 87.4931
2024-08-22 | 91.1300      | 87.5080
2024-08-23 | 92.2600      | 87.5189
2024-08-26 | 90.8600      | 87.5241
2024-08-27 | 90.8800      | 87.5233
2024-08-28 | 90.2100      | 87.5174
2024-08-29 | 90.3800      | 87.5082
2024-08-30 | 91.0100      | 87.4982
2024-09-03 | 88.6600      | 87.4893
2024-08-05 | 84.8500      | 87.5409
2024-08-06 | 84.6000      | 87.5615
2024-08-07 | 83.7000      | 87.5665
2024-08-08 | 85.4800      | 87.5570
2024-08-09 | 86.1200      | 87.5367
2024-08-12 | 86.6500      | 87.5112
2024-08-13 | 87.7600      | 87.4862
2024-08-14 | 88.2600      | 87.4669
2024-08-15 | 89.1600      | 87.4563
2024-08-16 | 90.2300      | 87.4554
2024-08-19 | 91.2600      | 87.4632
2024-08-20 | 91.6200      | 87.4769
2024-08-21 | 92.6400      | 87.4931
2024-08-22 | 91.1300      | 87.5080
2024-08-23 | 92.2600      | 87.5189
2024-08-26 | 90.8600      | 87.5241
2024-08-27 | 90.8800      | 87.5233
2024-08-28 | 90.2100      | 87.5174
2024-08-29 | 90.3800      | 87.5082
2024-08-30 | 91.0100      | 87.4982
2024-09-03 | 88.6600      | 87.4893
2024-09-04 | 86.2900      | 87.4833
2024-09-05 | 85.8300      | 87.4810
2024-09-06 | 84.9000      | 87.4823
2024-09-09 | 84.7100      | 87.4866
2024-09-10 | 85.1900      | 87.4925
2024-09-11 | 84.5600      | 87.4988
2024-09-12 | 84.9300      | 87.5039
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">horizons</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">28</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">horizon</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">horizons</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">]</span>
    
    <span class="n">dates_test</span> <span class="o">=</span> <span class="n">prediction_dates_no_rolling</span><span class="p">[</span><span class="n">horizon</span><span class="p">]</span>
    <span class="n">test_values</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dates_test</span><span class="p">]</span>
    <span class="n">predicted_values</span> <span class="o">=</span> <span class="n">results_no_rolling</span><span class="p">[</span><span class="n">horizon</span><span class="p">]</span>

    <span class="n">train_dates</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">index</span>
    <span class="n">train_values</span> <span class="o">=</span> <span class="n">train</span>
    
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">train_dates</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:],</span> <span class="n">y</span><span class="o">=</span><span class="n">train_values</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#00008B&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">dates_test</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">test_values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#32a850&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">dates_test</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">predicted_values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Forecast&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#a83264&#39;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Horizonte de </span><span class="si">{</span><span class="n">horizon</span><span class="si">}</span><span class="s1"> días&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Ajustar el diseño para evitar solapamientos</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bebfb1109047812584d4befb8ed33f92646af592e6f0fe04d460033c495e0499.png" src="_images/bebfb1109047812584d4befb8ed33f92646af592e6f0fe04d460033c495e0499.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">comparison_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Real&#39;</span><span class="p">:</span> <span class="n">test_values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
    <span class="s1">&#39;Predicted&#39;</span><span class="p">:</span> <span class="n">results_no_rolling</span><span class="p">[</span><span class="mi">28</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="p">})</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">comparison_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Predicted&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="n">min_val</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Real&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Predicted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">max_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Real&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">comparison_df</span><span class="p">[</span><span class="s1">&#39;Predicted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span> <span class="p">[</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Comparación entre Valores Reales y Predicciones&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Valor Real&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Valor Predicho&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1264f1b318d4b2992b5c148d533a51c8c3f6fe7e9f5c70d5a10bfd35dd1de2cf.png" src="_images/1264f1b318d4b2992b5c148d533a51c8c3f6fe7e9f5c70d5a10bfd35dd1de2cf.png" />
</div>
</div>
<p>La gráfica de correlación para los valores predichos con los esperados del conjunto de test para ARIMA (QHIC) sin rolling no se ve para nada bien, los valores obtenidos de las predicciones son todos muy similares, tal como se observa en las cuatro gráficas de arriba, cuyas predicciones siguen una distribución practicamente lineal (180 grados).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d7</span> <span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_values</span><span class="p">[:</span><span class="mi">7</span><span class="p">],</span> <span class="n">predicted_values</span><span class="p">[:</span><span class="mi">7</span><span class="p">])</span>
<span class="n">d14</span>  <span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_values</span><span class="p">[:</span><span class="mi">14</span><span class="p">],</span> <span class="n">predicted_values</span><span class="p">[:</span><span class="mi">14</span><span class="p">])</span>
<span class="n">d21</span><span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_values</span><span class="p">[:</span><span class="mi">21</span><span class="p">],</span> <span class="n">predicted_values</span><span class="p">[:</span><span class="mi">21</span><span class="p">])</span>
<span class="n">d28</span>  <span class="o">=</span> <span class="n">create_error_table</span><span class="p">(</span><span class="n">test_values</span><span class="p">[:</span><span class="mi">28</span><span class="p">],</span> <span class="n">predicted_values</span><span class="p">[:</span><span class="mi">28</span><span class="p">])</span>

<span class="n">nrhqic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Métrica&#39;</span><span class="p">:</span> <span class="n">d7</span><span class="p">[</span><span class="s1">&#39;Métrica&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 7&#39;</span><span class="p">:</span> <span class="n">d7</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 14&#39;</span><span class="p">:</span> <span class="n">d14</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 21&#39;</span><span class="p">:</span> <span class="n">d21</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Días 28&#39;</span><span class="p">:</span> <span class="n">d28</span><span class="p">[</span><span class="s1">&#39;Valor&#39;</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">nrhqic</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Métrica</th>
      <th>Días 7</th>
      <th>Días 14</th>
      <th>Días 21</th>
      <th>Días 28</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MAPE</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MAE</td>
      <td>2.021080</td>
      <td>2.580556</td>
      <td>2.752778</td>
      <td>2.636670</td>
    </tr>
    <tr>
      <th>2</th>
      <td>MSE</td>
      <td>5.442725</td>
      <td>8.608524</td>
      <td>9.266348</td>
      <td>8.345857</td>
    </tr>
    <tr>
      <th>3</th>
      <td>RMSE</td>
      <td>2.332965</td>
      <td>2.934029</td>
      <td>3.044068</td>
      <td>2.888920</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R2</td>
      <td>-2.394065</td>
      <td>-0.066262</td>
      <td>-0.303111</td>
      <td>-0.038277</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El <em>MAE</em> es de 2.636670, indicando que, en promedio, las predicciones para 28 días están a 2.637 unidades de los valores reales. El <em>MSE</em> es 8.345857, reflejando la variabilidad en los errores, mientras que el <em>RMSE</em>, con un valor de 2.888920, muestra que las predicciones se desvían en promedio unas 2.889 unidades de los valores reales. Finalmente, el coeficiente de determinación <em>R2</em> es de -0.038277, lo que sugiere que el modelo no solo tiene un ajuste deficiente, sino que está haciendo predicciones peores que las que se obtendrían al simplemente predecir la media de los valores reales.</p>
</section>
<section id="id6">
<h3><span class="math notranslate nohighlight">\(\mathtt{Normalidad\;e\;independencia\;de\;los\;residuos}\)</span><a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_predict</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modelohqic</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">order</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;best_order_hqic&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">)})</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">plot_predict</span><span class="p">(</span><span class="n">modelohqic</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b067d4606abc78b7c5807ed106aa88b37c58fe5b8ca434a19b1271eea22ac1ac.png" src="_images/b067d4606abc78b7c5807ed106aa88b37c58fe5b8ca434a19b1271eea22ac1ac.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modelohqic</span><span class="o">.</span><span class="n">plot_diagnostics</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2ee7a4fc327376c1d10247504c99fa8b86d6f80b2724ca4c11a118c55bcae0be.png" src="_images/2ee7a4fc327376c1d10247504c99fa8b86d6f80b2724ca4c11a118c55bcae0be.png" />
</div>
</div>
<p>El primer gráfico muestra los residuos (diferencia entre los valores observados y los valores ajustados) frente a los valores ajustados. Idealmente, los residuos deben estar distribuidos aleatoriamente alrededor de cero y no mostrar ningún patrón sistemático, sin embargo, en la gráfica en bastantes observaciones estos residuos difieren bastante de 0.</p>
<p>El segundo gráfico, histograma, muestra la distribución de los residuos en un histograma. La distribución debería parecerse a una distribución normal, con una forma de campana simétrica alrededor de cero. Un histograma muy asimétrico o sesgado indica que los residuos no están distribuidos normalmente. Tal como se observa en la gráfica, estos residuos no siguen una distribución normal, lo cual es confirmado con el tercer gráfico: Q-Q plot.</p>
<p>En cuanto a la cuarta gráfica, el correlograma, no se observa autocorrelación significativa en los diferentes retardos (lags). En el gráfico, las barras que se extienden más allá de las bandas de confianza indican autocorrelación en esos retardos, lo que sugiere que el modelo puede no estar capturando todas las dependencias en los datos, sin embargo, esto no se presenta para este modelo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resid_clean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">modelohqic</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">stat</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">shapiro</span><span class="p">(</span><span class="n">resid_clean</span><span class="p">)</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Normal&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No normal&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Statistics=</span><span class="si">%.3f</span><span class="s1">, p=</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No normal
Statistics=0.777, p=0.000
</pre></div>
</div>
</div>
</div>
<p>Esto confirma que los residuos no siguen una distribución normal, tal como se observaba en el histograma y los Q-Q plots.</p>
</section>
</section>
<section id="mathtt-analisis-de-metricas-por-criterio">
<h2><span class="math notranslate nohighlight">\(\mathtt{Análisis\;de\;métricas\;por\;criterio}\)</span><a class="headerlink" href="#mathtt-analisis-de-metricas-por-criterio" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Métrica 7 días&#39;</span><span class="p">:</span> <span class="n">raic</span><span class="p">[</span><span class="s1">&#39;Métrica&#39;</span><span class="p">],</span>
    <span class="s1">&#39;AIC - rolling&#39;</span><span class="p">:</span> <span class="n">raic</span><span class="p">[</span><span class="s1">&#39;Días 7&#39;</span><span class="p">],</span>
    <span class="s1">&#39;AIC - no rolling&#39;</span><span class="p">:</span> <span class="n">nraic</span><span class="p">[</span><span class="s1">&#39;Días 7&#39;</span><span class="p">],</span>
    <span class="s1">&#39;BIC - rolling&#39;</span><span class="p">:</span> <span class="n">rbic</span><span class="p">[</span><span class="s1">&#39;Días 7&#39;</span><span class="p">],</span>
    <span class="s1">&#39;BIC - no rolling&#39;</span><span class="p">:</span> <span class="n">nrbic</span><span class="p">[</span><span class="s1">&#39;Días 7&#39;</span><span class="p">],</span>
    <span class="s1">&#39;HQIC - rolling&#39;</span><span class="p">:</span> <span class="n">rhqic</span><span class="p">[</span><span class="s1">&#39;Días 7&#39;</span><span class="p">],</span>
    <span class="s1">&#39;HQIC - no rolling&#39;</span><span class="p">:</span> <span class="n">nrhqic</span><span class="p">[</span><span class="s1">&#39;Días 7&#39;</span><span class="p">],</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Métrica 7 días</th>
      <th>AIC - rolling</th>
      <th>AIC - no rolling</th>
      <th>BIC - rolling</th>
      <th>BIC - no rolling</th>
      <th>HQIC - rolling</th>
      <th>HQIC - no rolling</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MAPE</td>
      <td>1.312539</td>
      <td>NaN</td>
      <td>1.315387</td>
      <td>NaN</td>
      <td>15.597257</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MAE</td>
      <td>1.121135</td>
      <td>2.002013</td>
      <td>1.124287</td>
      <td>1.987144</td>
      <td>13.207305</td>
      <td>2.021080</td>
    </tr>
    <tr>
      <th>2</th>
      <td>MSE</td>
      <td>1.777947</td>
      <td>5.520341</td>
      <td>1.862735</td>
      <td>5.273568</td>
      <td>1024.359477</td>
      <td>5.442725</td>
    </tr>
    <tr>
      <th>3</th>
      <td>RMSE</td>
      <td>1.333397</td>
      <td>2.349541</td>
      <td>1.364820</td>
      <td>2.296425</td>
      <td>32.005616</td>
      <td>2.332965</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R2</td>
      <td>-0.108722</td>
      <td>-2.442467</td>
      <td>-0.161595</td>
      <td>-2.288580</td>
      <td>-637.787237</td>
      <td>-2.394065</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Al evaluar los seis modelos distintos, cada uno utilizando las métricas <strong>MAPE</strong>, <strong>MAE</strong>, <strong>MSE</strong>, <strong>RMSE</strong> y <strong>R²</strong>, y los criterios <strong>AIC</strong>, <strong>BIC</strong> y <strong>HQIC</strong>, se observa lo siguiente: para <strong>MAPE</strong>, el modelo rolling con <strong>AIC</strong> ofrece el valor menor de 1.312539. Para <strong>MAE</strong>, el modelo rolling con <strong>AIC</strong> muestra un valor de 1.121135, que es significativamente más bajo que el MAE de 2.002013 del modelo no rolling con <strong>AIC</strong>, indicando un menor error absoluto medio en el modelo rolling. En términos de <strong>MSE</strong>, el modelo rolling con <strong>AIC</strong> presenta un valor de 1.777947, frente al MSE más alto de 5.520341 del modelo no rolling, lo que sugiere una mejor precisión en el modelo rolling. El <strong>RMSE</strong> sigue la misma tendencia, con el modelo rolling con <strong>AIC</strong> mostrando un valor de 1.333397 frente al 2.349541 del modelo no rolling, reflejando un menor error cuadrático medio. Para <strong>R²</strong>, aunque ambos modelos tienen valores negativos, el modelo rolling con <strong>AIC</strong> (-0.108722) tiene un R² menos negativo en comparación con el modelo no rolling (-2.442467), sugiriendo un rendimiento ligeramente mejor.</p>
<p>En el caso de <strong>BIC</strong>, el modelo rolling con <strong>BIC</strong> tiene un <strong>MAPE</strong> de 1.315387, que es ligeramente peor que el modelo rolling con <strong>AIC</strong>. Para <strong>MAE</strong>, el modelo rolling con <strong>BIC</strong> muestra un valor de 1.124287, que es muy cercano al MAE del modelo rolling con <strong>AIC</strong>. El <strong>MSE</strong> para el modelo rolling con <strong>BIC</strong> es de 1.862735, que es mayor que el <strong>MSE</strong> del modelo rolling con <strong>AIC</strong> pero sigue siendo mejor que el de los modelos no rolling. El <strong>RMSE</strong> para el modelo rolling con <strong>BIC</strong> es de 1.364820, que es mayor que el del modelo rolling con <strong>AIC</strong> pero aún así no es mayor que el de los modelos no rolling. En cuanto al <strong>R²</strong>, el modelo rolling con <strong>BIC</strong> tiene un valor de -0.161595, que es menos negativo que el <strong>R²</strong> del modelo no rolling pero peor que el del modelo rolling con <strong>AIC</strong>.</p>
<p>Para <strong>HQIC</strong>, el modelo rolling con <strong>HQIC</strong> tiene un <strong>MAPE</strong> de 15.597257, que es considerablemente peor que todos los demás modelos. El <strong>MAE</strong> del modelo rolling con <strong>HQIC</strong> es de 13.207305, que también es más alto que los de los modelos <strong>AIC</strong> y <strong>BIC</strong>. El <strong>MSE</strong> es de 1024.359477, el más alto entre todos los modelos, y el <strong>RMSE</strong> de 32.005616 es igualmente el mayor. El <strong>R²</strong> para el modelo rolling con <strong>HQIC</strong> es -637.787237, extremadamente bajo, indicando el peor desempeño entre los modelos.</p>
<p>Es decir, el modelo rolling con <strong>AIC</strong> es el que generalmente muestra el mejor rendimiento en la mayoría de las métricas, seguido por el modelo rolling con <strong>BIC</strong>. Los modelos rolling, en general, tienden a superar a los modelos no rolling en términos de <strong>MAPE</strong>, <strong>MAE</strong>, <strong>MSE</strong> y <strong>RMSE</strong>. Los modelos con <strong>HQIC</strong> no ofrecen un rendimiento competitivo en comparación con los otros criterios.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Métrica 14 días&#39;</span><span class="p">:</span> <span class="n">raic</span><span class="p">[</span><span class="s1">&#39;Métrica&#39;</span><span class="p">],</span>
    <span class="s1">&#39;AIC - rolling&#39;</span><span class="p">:</span> <span class="n">raic</span><span class="p">[</span><span class="s1">&#39;Días 14&#39;</span><span class="p">],</span>
    <span class="s1">&#39;AIC - no rolling&#39;</span><span class="p">:</span> <span class="n">nraic</span><span class="p">[</span><span class="s1">&#39;Días 14&#39;</span><span class="p">],</span>
    <span class="s1">&#39;BIC - rolling&#39;</span><span class="p">:</span> <span class="n">rbic</span><span class="p">[</span><span class="s1">&#39;Días 14&#39;</span><span class="p">],</span>
    <span class="s1">&#39;BIC - no rolling&#39;</span><span class="p">:</span> <span class="n">nrbic</span><span class="p">[</span><span class="s1">&#39;Días 14&#39;</span><span class="p">],</span>
    <span class="s1">&#39;HQIC - rolling&#39;</span><span class="p">:</span> <span class="n">rhqic</span><span class="p">[</span><span class="s1">&#39;Días 14&#39;</span><span class="p">],</span>
    <span class="s1">&#39;HQIC - no rolling&#39;</span><span class="p">:</span> <span class="n">nrhqic</span><span class="p">[</span><span class="s1">&#39;Días 14&#39;</span><span class="p">],</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Métrica 14 días</th>
      <th>AIC - rolling</th>
      <th>AIC - no rolling</th>
      <th>BIC - rolling</th>
      <th>BIC - no rolling</th>
      <th>HQIC - rolling</th>
      <th>HQIC - no rolling</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MAPE</td>
      <td>1.212652</td>
      <td>NaN</td>
      <td>1.160648</td>
      <td>NaN</td>
      <td>8.370949</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MAE</td>
      <td>1.064800</td>
      <td>2.519703</td>
      <td>1.018572</td>
      <td>2.545715</td>
      <td>7.122699</td>
      <td>2.580556</td>
    </tr>
    <tr>
      <th>2</th>
      <td>MSE</td>
      <td>1.431246</td>
      <td>8.349668</td>
      <td>1.411075</td>
      <td>8.426731</td>
      <td>512.780690</td>
      <td>8.608524</td>
    </tr>
    <tr>
      <th>3</th>
      <td>RMSE</td>
      <td>1.196347</td>
      <td>2.889579</td>
      <td>1.187887</td>
      <td>2.902883</td>
      <td>22.644661</td>
      <td>2.934029</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R2</td>
      <td>0.822724</td>
      <td>-0.034200</td>
      <td>0.825223</td>
      <td>-0.043745</td>
      <td>-62.513607</td>
      <td>-0.066262</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Al evaluar los seis modelos distintos utilizando las métricas <strong>MAPE</strong>, <strong>MAE</strong>, <strong>MSE</strong>, <strong>RMSE</strong> y <strong>R²</strong>, y los criterios <strong>AIC</strong>, <strong>BIC</strong> y <strong>HQIC</strong> para un horizonte de 14 días, se observa lo siguiente: para <strong>MAPE</strong>, el modelo rolling con <strong>BIC</strong> ofrece el valor más bajo de 1.160648, que es superior al valor de 1.212652 del modelo rolling con <strong>AIC</strong>. Para <strong>MAE</strong>, el modelo rolling con <strong>BIC</strong> también presenta un valor de 1.018572, significativamente más bajo que el MAE de 1.064800 del modelo rolling con <strong>AIC</strong>, lo que indica una menor desviación media en el modelo rolling con <strong>BIC</strong>. En términos de <strong>MSE</strong>, el modelo rolling con <strong>BIC</strong> muestra un valor de 1.411075, que es ligeramente mejor que el MSE de 1.431246 del modelo rolling con <strong>AIC</strong>, pero ambos valores son mucho mejores que el MSE de 8.349668 de los modelos no rolling. El <strong>RMSE</strong> sigue la misma tendencia, con el modelo rolling con <strong>BIC</strong> mostrando un valor de 1.187887 frente al 1.196347 del modelo rolling con <strong>AIC</strong> y el valor más alto de 2.889579 de los modelos no rolling. Para <strong>R²</strong>, el modelo rolling con <strong>BIC</strong> tiene un valor de 0.825223, que es el más alto entre los modelos analizados y ligeramente mejor que el R² de 0.822724 del modelo rolling con <strong>AIC</strong>. Los modelos no rolling tienen valores de <strong>R²</strong> negativos, lo que indica un rendimiento inferior en comparación con los modelos rolling.</p>
<p>Para <strong>HQIC</strong>, el modelo rolling con <strong>HQIC</strong> muestra un <strong>MAPE</strong> de 8.370949, que es peor que los valores de los modelos <strong>AIC</strong> y <strong>BIC</strong>. El <strong>MAE</strong> del modelo rolling con <strong>HQIC</strong> es de 7.122699, que también es más alto en comparación con los modelos <strong>AIC</strong> y <strong>BIC</strong>. El <strong>MSE</strong> y el <strong>RMSE</strong> son también los más altos en el modelo rolling con <strong>HQIC</strong>, con valores de 512.780690 y 22.644661, respectivamente. El <strong>R²</strong> para el modelo rolling con <strong>HQIC</strong> es de -62.513607, el más bajo entre todos los modelos, lo que indica un rendimiento deficiente.</p>
<p>En resumen, el modelo rolling con <strong>BIC</strong> es el que generalmente muestra el mejor rendimiento en la mayoría de las métricas para un horizonte de 14 días, seguido por el modelo rolling con <strong>AIC</strong>. Los modelos rolling en general tienden a superar a los modelos no rolling en términos de <strong>MAPE</strong>, <strong>MAE</strong>, <strong>MSE</strong>, <strong>RMSE</strong> y <strong>R²</strong>. Los modelos con <strong>HQIC</strong> no ofrecen un rendimiento competitivo en comparación con los otros criterios.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Métrica 21 días&#39;</span><span class="p">:</span> <span class="n">raic</span><span class="p">[</span><span class="s1">&#39;Métrica&#39;</span><span class="p">],</span>
    <span class="s1">&#39;AIC - rolling&#39;</span><span class="p">:</span> <span class="n">raic</span><span class="p">[</span><span class="s1">&#39;Días 21&#39;</span><span class="p">],</span>
    <span class="s1">&#39;AIC - no rolling&#39;</span><span class="p">:</span> <span class="n">nraic</span><span class="p">[</span><span class="s1">&#39;Días 21&#39;</span><span class="p">],</span>
    <span class="s1">&#39;BIC - rolling&#39;</span><span class="p">:</span> <span class="n">rbic</span><span class="p">[</span><span class="s1">&#39;Días 21&#39;</span><span class="p">],</span>
    <span class="s1">&#39;BIC - no rolling&#39;</span><span class="p">:</span> <span class="n">nrbic</span><span class="p">[</span><span class="s1">&#39;Días 21&#39;</span><span class="p">],</span>
    <span class="s1">&#39;HQIC - rolling&#39;</span><span class="p">:</span> <span class="n">rhqic</span><span class="p">[</span><span class="s1">&#39;Días 21&#39;</span><span class="p">],</span>
    <span class="s1">&#39;HQIC - no rolling&#39;</span><span class="p">:</span> <span class="n">nrhqic</span><span class="p">[</span><span class="s1">&#39;Días 21&#39;</span><span class="p">],</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Métrica 21 días</th>
      <th>AIC - rolling</th>
      <th>AIC - no rolling</th>
      <th>BIC - rolling</th>
      <th>BIC - no rolling</th>
      <th>HQIC - rolling</th>
      <th>HQIC - no rolling</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MAPE</td>
      <td>1.146243</td>
      <td>NaN</td>
      <td>1.110016</td>
      <td>NaN</td>
      <td>5.924117</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MAE</td>
      <td>1.014617</td>
      <td>2.705316</td>
      <td>0.982382</td>
      <td>2.730000</td>
      <td>5.058275</td>
      <td>2.752778</td>
    </tr>
    <tr>
      <th>2</th>
      <td>MSE</td>
      <td>1.402353</td>
      <td>9.062227</td>
      <td>1.399503</td>
      <td>9.153116</td>
      <td>342.326566</td>
      <td>9.266348</td>
    </tr>
    <tr>
      <th>3</th>
      <td>RMSE</td>
      <td>1.184210</td>
      <td>3.010353</td>
      <td>1.183006</td>
      <td>3.025412</td>
      <td>18.502069</td>
      <td>3.044068</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R2</td>
      <td>0.802789</td>
      <td>-0.274406</td>
      <td>0.803190</td>
      <td>-0.287187</td>
      <td>-47.140810</td>
      <td>-0.303111</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Al evaluar los seis modelos distintos utilizando las métricas <strong>MAPE</strong>, <strong>MAE</strong>, <strong>MSE</strong>, <strong>RMSE</strong> y <strong>R²</strong>, y los criterios <strong>AIC</strong>, <strong>BIC</strong> y <strong>HQIC</strong> para un horizonte de 21 días, se observa lo siguiente: para <strong>MAPE</strong>, el modelo rolling con <strong>BIC</strong> presenta el valor más bajo de 1.110016, superando al modelo rolling con <strong>AIC</strong> que muestra un MAPE de 1.146243. En cuanto a <strong>MAE</strong>, el modelo rolling con <strong>BIC</strong> tiene un valor de 0.982382, que es notablemente mejor que el MAE de 1.014617 del modelo rolling con <strong>AIC</strong>, y también supera a los modelos no rolling que presentan valores más altos. Para <strong>MSE</strong>, el modelo rolling con <strong>BIC</strong> muestra un valor de 1.399503, que es ligeramente mejor que el MSE de 1.402353 del modelo rolling con <strong>AIC</strong>, y significativamente mejor que los valores más altos de los modelos no rolling. El <strong>RMSE</strong> sigue una tendencia similar, con el modelo rolling con <strong>BIC</strong> presentando un valor de 1.183006 frente al 1.184210 del modelo rolling con <strong>AIC</strong>, y superando al valor más alto de 3.010353 de los modelos no rolling. En términos de <strong>R²</strong>, el modelo rolling con <strong>BIC</strong> tiene un valor de 0.803190, que es el más alto entre todos los modelos, en comparación con el R² de 0.802789 del modelo rolling con <strong>AIC</strong> y los valores negativos de los modelos no rolling.</p>
<p>Para <strong>HQIC</strong>, el modelo rolling con <strong>HQIC</strong> muestra un <strong>MAPE</strong> de 5.924117, que es peor que los valores de los modelos <strong>AIC</strong> y <strong>BIC</strong>. El <strong>MAE</strong> del modelo rolling con <strong>HQIC</strong> es de 5.058275, lo cual también es superior a los valores de los modelos <strong>AIC</strong> y <strong>BIC</strong>. El <strong>MSE</strong> y el <strong>RMSE</strong> en el modelo rolling con <strong>HQIC</strong> son de 342.326566 y 18.502069, respectivamente, ambos significativamente más altos que los valores de los modelos <strong>AIC</strong> y <strong>BIC</strong>. El <strong>R²</strong> para el modelo rolling con <strong>HQIC</strong> es de -47.140810, el más bajo entre todos los modelos, indicando el peor desempeño.</p>
<p>En resumen, el modelo rolling con <strong>BIC</strong> demuestra el mejor rendimiento en la mayoría de las métricas para un horizonte de 21 días, seguido por el modelo rolling con <strong>AIC</strong>. Los modelos rolling generalmente superan a los modelos no rolling en términos de <strong>MAPE</strong>, <strong>MAE</strong>, <strong>MSE</strong>, <strong>RMSE</strong> y <strong>R²</strong>. Los modelos con <strong>HQIC</strong> no son competitivos en comparación con los otros criterios.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Métrica 28 días&#39;</span><span class="p">:</span> <span class="n">raic</span><span class="p">[</span><span class="s1">&#39;Métrica&#39;</span><span class="p">],</span>
    <span class="s1">&#39;AIC - rolling&#39;</span><span class="p">:</span> <span class="n">raic</span><span class="p">[</span><span class="s1">&#39;Días 28&#39;</span><span class="p">],</span>
    <span class="s1">&#39;AIC - no rolling&#39;</span><span class="p">:</span> <span class="n">nraic</span><span class="p">[</span><span class="s1">&#39;Días 28&#39;</span><span class="p">],</span>
    <span class="s1">&#39;BIC - rolling&#39;</span><span class="p">:</span> <span class="n">rbic</span><span class="p">[</span><span class="s1">&#39;Días 28&#39;</span><span class="p">],</span>
    <span class="s1">&#39;BIC - no rolling&#39;</span><span class="p">:</span> <span class="n">nrbic</span><span class="p">[</span><span class="s1">&#39;Días 28&#39;</span><span class="p">],</span>
    <span class="s1">&#39;HQIC - rolling&#39;</span><span class="p">:</span> <span class="n">rhqic</span><span class="p">[</span><span class="s1">&#39;Días 28&#39;</span><span class="p">],</span>
    <span class="s1">&#39;HQIC - no rolling&#39;</span><span class="p">:</span> <span class="n">nrhqic</span><span class="p">[</span><span class="s1">&#39;Días 28&#39;</span><span class="p">],</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Métrica 28 días</th>
      <th>AIC - rolling</th>
      <th>AIC - no rolling</th>
      <th>BIC - rolling</th>
      <th>BIC - no rolling</th>
      <th>HQIC - rolling</th>
      <th>HQIC - no rolling</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MAPE</td>
      <td>1.087074</td>
      <td>NaN</td>
      <td>1.059167</td>
      <td>NaN</td>
      <td>4.669373</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MAE</td>
      <td>0.955439</td>
      <td>2.618068</td>
      <td>0.930715</td>
      <td>2.624643</td>
      <td>3.987300</td>
      <td>2.636670</td>
    </tr>
    <tr>
      <th>2</th>
      <td>MSE</td>
      <td>1.324720</td>
      <td>8.271219</td>
      <td>1.317260</td>
      <td>8.282847</td>
      <td>257.006110</td>
      <td>8.345857</td>
    </tr>
    <tr>
      <th>3</th>
      <td>RMSE</td>
      <td>1.150965</td>
      <td>2.875973</td>
      <td>1.147719</td>
      <td>2.877993</td>
      <td>16.031410</td>
      <td>2.888920</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R2</td>
      <td>0.835196</td>
      <td>-0.028992</td>
      <td>0.836125</td>
      <td>-0.030439</td>
      <td>-30.973186</td>
      <td>-0.038277</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Al analizar los seis modelos distintos para un horizonte de 28 días utilizando las métricas <strong>MAPE</strong>, <strong>MAE</strong>, <strong>MSE</strong>, <strong>RMSE</strong> y <strong>R²</strong>, y los criterios <strong>AIC</strong>, <strong>BIC</strong> y <strong>HQIC</strong>, se observa lo siguiente: para <strong>MAPE</strong>, el modelo rolling con <strong>BIC</strong> presenta el valor más bajo de 1.059167, superando al modelo rolling con <strong>AIC</strong>, que tiene un MAPE de 1.087074. En cuanto a <strong>MAE</strong>, el modelo rolling con <strong>BIC</strong> muestra un valor de 0.930715, que es el más bajo entre todos los modelos, incluyendo los modelos no rolling, que tienen valores más altos. El <strong>MSE</strong> para el modelo rolling con <strong>BIC</strong> es de 1.317260, ligeramente mejor que el MSE de 1.324720 del modelo rolling con <strong>AIC</strong>, y notablemente mejor que los valores más altos de los modelos no rolling. El <strong>RMSE</strong> sigue la misma tendencia, con el modelo rolling con <strong>BIC</strong> mostrando un valor de 1.147719 frente al 1.150965 del modelo rolling con <strong>AIC</strong>, y superando al valor más alto de 2.875973 de los modelos no rolling. En términos de <strong>R²</strong>, el modelo rolling con <strong>BIC</strong> tiene un valor de 0.836125, que es el más alto entre todos los modelos, en comparación con el R² de 0.835196 del modelo rolling con <strong>AIC</strong> y los valores negativos de los modelos no rolling.</p>
<p>Para <strong>HQIC</strong>, el modelo rolling con <strong>HQIC</strong> muestra un <strong>MAPE</strong> de 4.669373, que es peor que los valores de los modelos <strong>AIC</strong> y <strong>BIC</strong>. El <strong>MAE</strong> del modelo rolling con <strong>HQIC</strong> es de 3.987300, también superior a los valores de los modelos <strong>AIC</strong> y <strong>BIC</strong>. El <strong>MSE</strong> y el <strong>RMSE</strong> para el modelo rolling con <strong>HQIC</strong> son de 257.006110 y 16.031410, respectivamente, ambos considerablemente más altos que los valores de los modelos <strong>AIC</strong> y <strong>BIC</strong>. El <strong>R²</strong> para el modelo rolling con <strong>HQIC</strong> es de -30.973186, el más bajo entre todos los modelos, indicando el peor desempeño.</p>
<p>En conclusión, el modelo rolling con <strong>BIC</strong> muestra el mejor rendimiento en la mayoría de las métricas para un horizonte de 28 días, seguido por el modelo rolling con <strong>AIC</strong>. Los modelos rolling en general superan a los modelos no rolling en términos de <strong>MAPE</strong>, <strong>MAE</strong>, <strong>MSE</strong>, <strong>RMSE</strong> y <strong>R²</strong>. Los modelos con <strong>HQIC</strong> no ofrecen un rendimiento competitivo en comparación con los otros criterios.</p>
<section id="mathtt-conclusiones">
<h3><span class="math notranslate nohighlight">\(\mathtt{Conclusiones}\)</span><a class="headerlink" href="#mathtt-conclusiones" title="Link to this heading">#</a></h3>
<p>En conclusión general, los modelos rolling con <strong>AIC</strong> y <strong>BIC</strong> son consistentemente los mejores en comparación con los modelos no rolling, con una ligera ventaja del modelo rolling con <strong>BIC</strong> para horizontes más largos. Los modelos con <strong>HQIC</strong> no muestran un rendimiento competitivo en comparación con los modelos con <strong>AIC</strong> y <strong>BIC</strong> en los diferentes horizontes de predicción.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Series de tiempo</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-sobre-logitech"><span class="math notranslate nohighlight">\(\mathtt{Sobre\;Logitech}\)</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-desarrollo"><span class="math notranslate nohighlight">\(\mathtt{Desarrollo}\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-librerias"><span class="math notranslate nohighlight">\(\mathtt{Librerías}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-importar-datos"><span class="math notranslate nohighlight">\(\mathtt{Importar\;datos}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-analisis-exploratorio"><span class="math notranslate nohighlight">\(\mathtt{Análisis\;exploratorio}\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-serie-original"><span class="math notranslate nohighlight">\(\mathtt{Serie\;original}\)</span></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-autocorrelacion"><span class="math notranslate nohighlight">\(\mathtt{Autocorrelación}\)</span></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-autocorrelacion-parcial"><span class="math notranslate nohighlight">\(\mathtt{Autocorrelación\;parcial}\)</span></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-estacionariedad-por-metodo-analitico-dickey-fuller"><span class="math notranslate nohighlight">\(\mathtt{Estacionariedad\;por\;método\;analítico\;(Dickey\;Fuller)}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-descomposicion-de-la-serie"><span class="math notranslate nohighlight">\(\mathtt{Descomposición\;de\;la\;serie}\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-modelo-arima"><span class="math notranslate nohighlight">\(\mathtt{Modelo:\;ARIMA}\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-diferenciacion"><span class="math notranslate nohighlight">\(\mathtt{Diferenciación}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-criterios-aic-bic-hqic"><span class="math notranslate nohighlight">\(\mathtt{Criterios\;AIC,\;BIC,\;HQIC}\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-funciones-auxiliares"><span class="math notranslate nohighlight">\(\mathtt{Funciones\;auxiliares}\)</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-arima-aic"><span class="math notranslate nohighlight">\(\mathtt{ARIMA:\;AIC}\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-arima-con-rolling"><span class="math notranslate nohighlight">\(\mathtt{ARIMA \; con\;rolling}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-arima-sin-rolling"><span class="math notranslate nohighlight">\(\mathtt{ARIMA\;sin\;rolling}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-normalidad-e-independencia-de-los-residuos"><span class="math notranslate nohighlight">\(\mathtt{Normalidad\;e\;independencia\;de\;los\;residuos}\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-arima-bic"><span class="math notranslate nohighlight">\(\mathtt{ARIMA:\;BIC}\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"><span class="math notranslate nohighlight">\(\mathtt{ARIMA \; con\;rolling}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2"><span class="math notranslate nohighlight">\(\mathtt{ARIMA \; sin\;rolling}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3"><span class="math notranslate nohighlight">\(\mathtt{Normalidad\;e\;independencia\;de\;los\;residuos}\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-arima-hqic"><span class="math notranslate nohighlight">\(\mathtt{ARIMA:\;HQIC}\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4"><span class="math notranslate nohighlight">\(\mathtt{ARIMA \; con\;rolling}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5"><span class="math notranslate nohighlight">\(\mathtt{ARIMA \; sin\;rolling}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6"><span class="math notranslate nohighlight">\(\mathtt{Normalidad\;e\;independencia\;de\;los\;residuos}\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-analisis-de-metricas-por-criterio"><span class="math notranslate nohighlight">\(\mathtt{Análisis\;de\;métricas\;por\;criterio}\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathtt-conclusiones"><span class="math notranslate nohighlight">\(\mathtt{Conclusiones}\)</span></a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Valentina Bustamante
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>